<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Eucalyptus on hablog</title>
    <link>http://blog.osamu.habuka.jp/tags/eucalyptus/</link>
    <description>Recent content in Eucalyptus on hablog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-jp</language>
    <lastBuildDate>Sat, 05 Dec 2015 05:05:37 +0900</lastBuildDate>
    <atom:link href="http://blog.osamu.habuka.jp/tags/eucalyptus/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Eucalyptus LiveDVD を作ってみる 3日目</title>
      <link>http://blog.osamu.habuka.jp/post/2015-12-05-japan-eucalyptus-advent-calendar-2015-day-3/</link>
      <pubDate>Sat, 05 Dec 2015 05:05:37 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2015-12-05-japan-eucalyptus-advent-calendar-2015-day-3/</guid>
      <description>&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/752&#34;&gt;(1枚目) Japan Eucalyptus Advent Calendar 2015&lt;/a&gt; の3日目のエントリです。&lt;/p&gt;

&lt;p&gt;え？更新が途切れた？そんなバカな…。2日目の続きをやりまぁす。&lt;/p&gt;

&lt;p&gt;2日目のログをもう少し遡ると以下のように変なところで umount が走ってコケてます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  Installing: comps-extras                 ##################### [456/456]warning: %posttrans(nfs-uti
-1:1.2.3-64.el6.x86_64) scriptlet failed, exit status 6
error reading information on service NetworkManager: No such file or directory
error reading information on service sshd: No such file or directory
+ echo RUN_FIRSTBOOT=NO
+ sed -i -e &#39;s/^Defaults    requiretty/#Defaults    requiretty/&#39; /etc/sudoers
+ /usr/sbin/useradd -c &#39;LiveMedia default user&#39; eucalyquitous
+ /usr/bin/passwd -d eucalyquitous
+ echo &#39;eucalyquitous     ALL=(ALL)     NOPASSWD: ALL&#39;
+ /bin/sed -i -e &#39;s|^\(exec /sbin/mingetty \)\(.*\)|\1 --autologin eucalyquitous \2|&#39; /etc/init/tty.c
f
umount: /mnt/livecd/tmp/imgcreate-6F78B4/install_root/proc: device is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
umount: /mnt/livecd/tmp/imgcreate-6F78B4/install_root: device is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
loop: can&#39;t delete device /dev/loop0: Device or resource busy
e2fsck 1.41.12 (17-May-2010)
_Eucalyquitous: recovering journal
Pass 1: Checking inodes, blocks, and sizes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;んじゃー、ビルドが成功している Wakame-vdc の LiveDVD ではここはどうなっているのかと言うと、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  Installing: gnome-backgrounds            ##################### [907/907]error reading information
 on service NetworkManager: No such file or directory
cp: cannot stat `/etc/resolv.conf&#39;: No such file or directory
+ echo RUN_FIRSTBOOT=NO
+ sed -i -e &#39;s/^Defaults    requiretty/#Defaults    requiretty/&#39; /etc/sudoers
+ /usr/sbin/useradd -c &#39;LiveMedia default user&#39; wakame
+ /usr/bin/passwd -d wakame
+ echo &#39;wakame     ALL=(ALL)     NOPASSWD: ALL&#39;
+ /bin/sed -i -e &#39;s|^\(exec /sbin/mingetty \)\(.*\)|\1 --autologin wakame \2|&#39; /etc/init/tty.conf
+ sed -i -e &#39;s/\[daemon\]/[daemon]\nTimedLoginEnable=true\nTimedLogin=wakame\nTimedLoginDelay=10/&#39; /etc/gdm/custom.conf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;やはり変な umount は発生していないようです。&lt;/p&gt;

&lt;p&gt;違う点と言えば Wakame-vdc LiveDVD のほうでは他にも処理を入れていることと、%post &amp;ndash;nochroot のセクションもあるという点です。なのでバッドノウハウな気もしますが、以下の処理を追加で kickstart に入れて再度ビルドしてみました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;%post --nochroot

cat &amp;gt; /root/postnochroot-install &amp;lt;&amp;lt; EOF_postnochroot
#!/bin/bash

rm -rf ${INSTALL_ROOT}/usr/share/{doc,man,info}

EOF_postnochroot

/bin/bash -x /root/postnochroot-install 2&amp;gt;&amp;amp;1 | tee /root/postnochroot-install.log
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;うーん、やっぱり以下のように失敗します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;+ rm -rf /mnt/livecd/tmp/imgcreate-O60XR_/install_root/usr/share/doc /mnt/livecd/tmp/imgcreate-O60XR_
/install_root/usr/share/man /mnt/livecd/tmp/imgcreate-O60XR_/install_root/usr/share/info
umount: /mnt/livecd/tmp/imgcreate-O60XR_/install_root/proc: device is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
umount: /mnt/livecd/tmp/imgcreate-O60XR_/install_root: device is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
loop: can&#39;t delete device /dev/loop1: Device or resource busy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;fuser で見てみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;+ rm -rf /mnt/livecd/tmp/imgcreate-lWxyO0/install_root/usr/share/doc /mnt/livecd/tmp/imgcreate-lWxyO0
/install_root/usr/share/man /mnt/livecd/tmp/imgcreate-lWxyO0/install_root/usr/share/info
+ /sbin/fuser -vm /mnt/livecd/tmp/imgcreate-lWxyO0/install_root/proc/
                     USER        PID ACCESS COMMAND
/mnt/livecd/tmp/imgcreate-lWxyO0/install_root/proc/:
                     root       1355 f.... rsyslogd
                     root       1445 f.... acpid
                     haldaemon   1457 f.... hald
                     root       3440 F.... libvirtd
                     root       7273 F.... libvirtd
                     root      13917 F.... libvirtd
                     root      14660 F.... libvirtd
                     root      19529 F.... libvirtd
                     root      28104 F.... libvirtd
umount: /mnt/livecd/tmp/imgcreate-lWxyO0/install_root/proc: device is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
umount: /mnt/livecd/tmp/imgcreate-lWxyO0/install_root: device is busy.
        (In some cases useful info about processes that use
         the device is found by lsof(8) or fuser(1))
loop: can&#39;t delete device /dev/loop5: Device or resource busy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;libvirtd&amp;hellip;.？あぁ！もしかして！と思い Eucalyptus に関するパッケージのインストール指定を外してビルドしてみると&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;+ rm -rf /mnt/livecd/tmp/imgcreate-tERkpC/install_root/usr/share/doc /mnt/livecd/tmp/imgcreate-tERkpC
/install_root/usr/share/man /mnt/livecd/tmp/imgcreate-tERkpC/install_root/usr/share/info
+ /sbin/fuser -vm /mnt/livecd/tmp/imgcreate-tERkpC/install_root/proc/
                     USER        PID ACCESS COMMAND
/mnt/livecd/tmp/imgcreate-tERkpC/install_root/proc/:
                     root       1355 f.... rsyslogd
                     root       1445 f.... acpid
                     haldaemon   1457 f.... hald
                     root       3440 F.... libvirtd
                     root       7273 F.... libvirtd
                     root      13917 F.... libvirtd
                     root      14660 F.... libvirtd
                     root      19529 F.... libvirtd
                     root      28104 F.... libvirtd
e2fsck 1.41.12 (17-May-2010)
Pass 1: Checking inodes, blocks, and sizes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あれ？半分勘違い。てっきり libvirtd はインストールした Eucalyptus のパッケージに動かされたのかと思いましたが、どうやら表示されているのはビルド環境のホスト側の情報だったみたいです。が、一方で umount のエラーが消えたのはやはり Eucalyptus のパッケージが関係しているようです。&lt;/p&gt;

&lt;p&gt;ということで、Eucalyptus のパッケージをインストールすると何が起きるのかを見てみたいと思います。&lt;/p&gt;

&lt;p&gt;まずインストールされるパッケージは以下。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# grep &amp;quot;Installing: euca&amp;quot; 20151203-4.eucaly.log
  Installing: eucalyptus                   ##################### [251/456] 
  Installing: eucalyptus-blockdev-utils    ##################### [259/456]/var/tmp/rpm-tmp.EoxuZE: line 2: /sbin/service: No such file or directory
  Installing: eucalyptus-axis2c-common     ##################### [377/456] 
  Installing: euca2ools                    ##################### [379/456] 
  Installing: eucalyptus-admin-tools       ##################### [380/456] 
  Installing: eucalyptus-imaging-toolkit   ##################### [389/456] 
  Installing: eucanetd                     ##################### [418/456] 
  Installing: eucalyptus-common-java-libs  ##################### [423/456] 
  Installing: eucalyptus-common-java       ##################### [424/456] 
  Installing: eucalyptus-nc                ##################### [442/456]Stopping libvirtd daemon: [FAILED]
  Installing: eucalyptus-sc                ##################### [444/456]Starting SCSI target daemon: [  OK  ]
  Installing: eucalyptus-cloud             ##################### [445/456] 
  Installing: eucalyptus-walrus            ##################### [446/456] 
  Installing: eucalyptus-cc                ##################### [447/456] 
  Installing: eucaconsole                  ##################### [449/456] 
  Installing: eucalyptus-service-image     ##################### [450/456] 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;これらのパッケージをダウンロードして何が実行されるかを見ます。で、全部をここに貼るのもアレなので原因になるものだけ。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# rpm -qp --scripts eucalyptus-nc-4.2.0-0.0.24054.2.el6.x86_64.rpm 
警告: eucalyptus-nc-4.2.0-0.0.24054.2.el6.x86_64.rpm: ヘッダ V4 RSA/SHA1 Signature, key ID c1240596: NOKEY
postinstall scriptlet (using /bin/sh):
if [ -e /etc/rc.d/init.d/libvirtd ]; then
    chkconfig --add libvirtd
    /sbin/service libvirtd restart
fi
chkconfig --add eucalyptus-nc
usermod -a -G kvm eucalyptus
exit 0
preuninstall scriptlet (using /bin/sh):
if [ &amp;quot;$1&amp;quot; = &amp;quot;0&amp;quot; ]; then
    if [ -f /etc/eucalyptus/eucalyptus.conf ]; then
        /sbin/service eucalyptus-nc stop
    fi
    chkconfig --del eucalyptus-nc
fi
exit 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あぁ、やっぱり libvirtd を起動してますね。あとは&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# rpm -qp --scripts eucalyptus-sc-4.2.0-0.0.24054.2.el6.x86_64.rpm 
警告: eucalyptus-sc-4.2.0-0.0.24054.2.el6.x86_64.rpm: ヘッダ V4 RSA/SHA1 Signature, key ID c1240596: NOKEY
postinstall scriptlet (using /bin/sh):
if [ -e /etc/rc.d/init.d/tgtd ]; then
    chkconfig --add tgtd
    /sbin/service tgtd start
fi
exit 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あぁ、tgtd も起動してますね。他は無さそうですので、この2つを停止するように kickstart ファイルに書いてビルドします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;+ /bin/sed -i -e &#39;s|^\(exec /sbin/mingetty \)\(.*\)|\1 --autologin eucalyquitous \2|&#39; /etc/init/tty.c
onf
+ /sbin/service libvirtd stop
Stopping libvirtd daemon:                                  [  OK  ]
+ /sbin/service tgtd stop
Stopping SCSI target daemon:                               [  OK  ]
+ rm -rf /mnt/livecd/tmp/imgcreate-ST404K/install_root/usr/share/doc /mnt/livecd/tmp/imgcreate-ST404K
/install_root/usr/share/man /mnt/livecd/tmp/imgcreate-ST404K/install_root/usr/share/info
e2fsck 1.41.12 (17-May-2010)
Pass 1: Checking inodes, blocks, and sizes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;やったー。成功です。ってことで、明日はこの作成した ISO ファイルで起動して Eucalyptus のセットアップができるかを試してみます。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus LiveDVD を作ってみる 2日目</title>
      <link>http://blog.osamu.habuka.jp/post/2015-12-01-japan-eucalyptus-advent-calendar-2015-day-2/</link>
      <pubDate>Tue, 01 Dec 2015 23:03:40 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2015-12-01-japan-eucalyptus-advent-calendar-2015-day-2/</guid>
      <description>&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/752&#34;&gt;(1枚目) Japan Eucalyptus Advent Calendar 2015&lt;/a&gt; の2日目のエントリです。&lt;/p&gt;

&lt;p&gt;どうせ誰も見てないんだからくだらない前置きとかもう止めます。チラ裏はチラ裏なりに駄文でも書いておけばいんじゃないかと思いますが、あまりにも駄文すぎて資源の無駄遣いなので、もう本題に入ります。&lt;/p&gt;

&lt;p&gt;さて昨日作った ISO ファイルから起動してみるんですが、root ユーザのパスワードを設定してなかったのでログインできずに意味のない LiveDVD になってしまってました…orz&lt;/p&gt;

&lt;p&gt;ということで、昨日の ks ファイルを修正し、以下のようにしてパスワードなしでログインできるようにしました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;lang en_US.UTF-8
keyboard us
timezone Asia/Tokyo
auth --useshadow --enablemd5
selinux --disabled
firewall --disabled

repo --name=base        --baseurl=http://ftp.iij.ad.jp/pub/linux/centos/6.7/os/$basearch
repo --name=updates     --baseurl=http://ftp.iij.ad.jp/pub/linux/centos/6.7/updates/$basearch
repo --name=extras      --baseurl=http://ftp.iij.ad.jp/pub/linux/centos/6.7/extras/$basearch
repo --name=epel        --baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch
repo --name=eucalyptus  --baseurl=http://downloads.eucalyptus.com/software/eucalyptus/4.2/centos/6/$basearch
repo --name=euca2ools   --baseurl=http://downloads.eucalyptus.com/software/euca2ools/3.3/centos/6/$basearch

xconfig --startxonboot

#services --disabled=NetworkManager,network,sshd

%pre

%packages
bash
kernel
syslinux
passwd
policycoreutils
chkconfig
authconfig
rootfiles
comps-extras
xkeyboard-config
dhclient
livecd-tools
# for eucalyptus
eucalyptus-nc
eucalyptus-cloud
eucalyptus-service-image
eucalyptus-cloud
eucaconsole
eucalyptus-cc
eucalyptus-sc
eucalyptus-walrus


%post

echo &amp;quot;Eucalyptus LiveDVD release 15.12 (Final)&amp;quot; &amp;gt; /etc/redhat-release
LIVE_USER=&amp;quot;eucalyquitous&amp;quot;

cat &amp;gt; /root/post-install &amp;lt;&amp;lt; EOF_post
#!/bin/bash

# turn off firstboot for livecd boots
echo &amp;quot;RUN_FIRSTBOOT=NO&amp;quot; &amp;gt; /etc/sysconfig/firstboot

sed -i -e &amp;quot;s/^Defaults    requiretty/#Defaults    requiretty/&amp;quot; /etc/sudoers

## create the LiveCD default user
# add default user with no password
/usr/sbin/useradd -c &amp;quot;LiveMedia default user&amp;quot; $LIVE_USER
/usr/bin/passwd -d $LIVE_USER &amp;gt; /dev/null
# give default user sudo privileges
echo &amp;quot;$LIVE_USER     ALL=(ALL)     NOPASSWD: ALL&amp;quot; &amp;gt;&amp;gt; /etc/sudoers
/bin/sed -i -e &amp;quot;s|^\(exec /sbin/mingetty \)\(.*\)|\1 --autologin $LIVE_USER \2|&amp;quot; /etc/init/tty.conf

EOF_post

/bin/bash -x /root/post-install 2&amp;gt;&amp;amp;1 | tee /root/post-install.log

#echo &amp;quot;timeout 40;&amp;quot; &amp;gt; /etc/dhclient.conf
cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;が、何故かオートログインできないどころか、sudo でスーパーユーザにすら昇格できない…。そしてあーだこーだやっているうちに、とうとう以下のようなエラーまで出てくる始末…。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Free inodes count wrong (61919, counted=61935).
Fix? yes


_Eucalyquitous: ***** FILE SYSTEM WAS MODIFIED *****
_Eucalyquitous: 36369/98304 files (0.1% non-contiguous), 371591/379653 blocks
/usr/lib/python2.6/site-packages/imgcreate/errors.py:45: DeprecationWarning: BaseException.message has been deprecated as of Python 2.6
  return unicode(self.message)
Error creating Live CD : fsck after resize returned an error!  image to debug at /tmp/resize-image-Uwn9U7


lazy umount succeeded on /mnt/livecd/tmp/imgcreate-08HiGO/install_root//proc
Unmounting directory /mnt/livecd/tmp/imgcreate-08HiGO/install_root failed, using lazy umount
lazy umount succeeded on /mnt/livecd/tmp/imgcreate-08HiGO/install_root
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;なんか不穏なエラー…。&lt;/p&gt;

&lt;p&gt;といったところでタイムアップです…中途半端な状況ですがデバッグは明日。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus LiveDVD を作ってみる 1日目</title>
      <link>http://blog.osamu.habuka.jp/post/2015-11-30-japan-eucalyptus-advent-calendar-2015-day-1/</link>
      <pubDate>Mon, 30 Nov 2015 23:22:39 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2015-11-30-japan-eucalyptus-advent-calendar-2015-day-1/</guid>
      <description>

&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/752&#34;&gt;(1枚目) Japan Eucalyptus Advent Calendar 2015&lt;/a&gt; の1日目のエントリです。&lt;/p&gt;

&lt;p&gt;えーと、何をトチ狂ったのか、一人で25日間ですよ。2013年に同じことやって帯状疱疹でまともにエントリを埋められなかった失態を忘れてしまったんですかね？&lt;/p&gt;

&lt;p&gt;僕らが敬愛する利根川先生の声が聞こえてきますよ。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;バカがっ…！&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;とんでもない誤解だ…！&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;世間というものはとどのつまり&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Eucalyptus Advent Calendar には何ひとつエントリしない…！&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;うん、まぁ、気のせいですね。&lt;/p&gt;

&lt;p&gt;で、本当はこのエントリで Eucalyptus LiveDVD を公開し、後ろの日付の人達にバトンを渡す予定でしたが、知ってました？リレーって独りじゃ出来無いっぽいっすよ？マジで。&lt;/p&gt;

&lt;p&gt;ってことで、検索 bot 以外に誰も見てないと思いますので、超マイペースで LiveDVD の作成日記を25日ぐらいかけてゆっくりやろうと思います。なるべく25日間失敗し続けますように。&lt;/p&gt;

&lt;p&gt;まず今日は背伸びをせずに「LiveDVD 作成用環境の準備」と「Eucalyptus のパッケージが入っているだけの LiveDVD を作る」の2つをやって終わりとします。&lt;/p&gt;

&lt;h1 id=&#34;livedvd-作成用環境の準備&#34;&gt;LiveDVD 作成用環境の準備&lt;/h1&gt;

&lt;p&gt;もうね、説明とか丁寧にするの面倒なので、&lt;a href=&#34;https://github.com/axsh/iso-no-wakame/wiki/HowtoCreateEnvironmentForLiveDVD&#34;&gt;Wakame-vdc LiveDVD の作成環境の作り方&lt;/a&gt;でも参考にして作ってください。&lt;/p&gt;

&lt;p&gt;ほんとチョー簡単。&lt;/p&gt;

&lt;h1 id=&#34;eucalyptus-のパッケージが入っているだけの-livedvd-を作る&#34;&gt;Eucalyptus のパッケージが入っているだけの LiveDVD を作る&lt;/h1&gt;

&lt;p&gt;kickstart ファイル「eucalyquitous.ks」を以下の内容で保存します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;lang en_US.UTF-8
keyboard us
timezone Asia/Tokyo
auth --useshadow --enablemd5
selinux --disabled
firewall --disabled

repo --name=base        --baseurl=http://ftp.iij.ad.jp/pub/linux/centos/6.7/os/$basearch
repo --name=updates     --baseurl=http://ftp.iij.ad.jp/pub/linux/centos/6.7/updates/$basearch
repo --name=extras      --baseurl=http://ftp.iij.ad.jp/pub/linux/centos/6.7/extras/$basearch
repo --name=epel        --baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch
repo --name=eucalyptus  --baseurl=http://downloads.eucalyptus.com/software/eucalyptus/4.2/centos/6/$basearch
repo --name=euca2ools   --baseurl=http://downloads.eucalyptus.com/software/euca2ools/3.3/centos/6/$basearch

xconfig --startxonboot

#services --disabled=NetworkManager,network,sshd

%pre

%packages
bash
kernel
syslinux
passwd
policycoreutils
chkconfig
authconfig
rootfiles
comps-extras
xkeyboard-config
dhclient
livecd-tools
# for eucalyptus
eucalyptus-nc
eucalyptus-cloud
eucalyptus-service-image
eucalyptus-cloud
eucaconsole
eucalyptus-cc
eucalyptus-sc
eucalyptus-walrus


%post
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、このファイルのある場所で以下を実行します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# LANG=C livecd-creator --config=eucalyquitous.ks --fslabel=Eucalyquitous
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、しばらくすると ISO ファイルが作成されます。ちなみに↑のksファイルで作成すると約CD1枚分ほどのサイズの ISO ファイルが出来ました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# ls -hal Eucalyquitous.iso 
-rw-r--r-- 1 root root 634M Dec  1 01:33 Eucalyquitous.iso
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;明日はこの ISO ファイルから起動してみます。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>1ノードで何台起動できるか？</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-15-eucalyptus-advent-calendar-2014-15th/</link>
      <pubDate>Mon, 15 Dec 2014 23:08:28 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-15-eucalyptus-advent-calendar-2014-15th/</guid>
      <description>&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/547&#34;&gt;Eucalyptus Advent Calendar 2014&lt;/a&gt; の15日目のエントリです。昨日は私のエントリ「&lt;a href=&#34;http://blog.osamu.habuka.jp/blog/2014/12/15/eucalyptus-advent-calendar-2014-14th/&#34;&gt;CirrOS を Eucalyptus4 で動かしてみる&lt;/a&gt;」でした。まぁ、動かなかったんですけどね。&lt;/p&gt;

&lt;p&gt;今日は「1ノードで何台起動できるか？」です。もうタイトルからして失敗の匂いがプンプンしやがります。&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;で、環境ですが、この Advent Calendar でやってきたように、KVM のゲスト OS 上に Eucalyptus 環境を立ててますので、そこで大量のインスタンスを起動してみたいと思います。本当は昨日のエントリで CirrOS が無事起動した続きとしてこのエントリが引き立つはずでしたが、なんか失敗への道筋が出来上がっている気がしてなりません。&lt;/p&gt;

&lt;p&gt;Eucalyptus 環境のメモリは約 12GB で、インスタンスに使用できるディスク容量は約 60GB で、CPU コア数はたったの2コアという貧相な環境です。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@euca4 ~]# free -m
             total       used       free     shared    buffers     cached
Mem:         11902       3356       8546        295          1       1232
-/+ buffers/cache:       2123       9779
Swap:         3967          0       3967

[root@euca4 ~]# df -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/vg_euca4-lv_root
                       50G   14G   33G  30% /
tmpfs                 6.2G  164K  6.2G   1% /dev/shm
/dev/vda1             477M   61M  391M  14% /boot
/dev/mapper/vg_euca4-lv_home
                       64G  2.4G   59G   4% /var/lib/eucalyptus

[root@euca4 ~]# grep ^pro /proc/cpuinfo 
processor   : 0
processor   : 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;それでも無理矢理設定して、256 インスタンスまでは起動できるようにしてみました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@euca4 ~]# euca-describe-availability-zones verbose
AVAILABILITYZONE    default 192.168.122.115 arn:euca:eucalyptus:default:cluster:default-cc-1/   
AVAILABILITYZONE    |- vm types free / max   cpu   ram  disk    
AVAILABILITYZONE    |- m1.small 0256 / 0256   1     32     1    
AVAILABILITYZONE    |- t1.micro 0203 / 0203   1     64     1    
AVAILABILITYZONE    |- m1.medium    0101 / 0101   1    128     1    
AVAILABILITYZONE    |- c1.medium    0025 / 0025   2    512    10    
AVAILABILITYZONE    |- m1.large 0025 / 0025   2    512    10    
AVAILABILITYZONE    |- m1.xlarge    0012 / 0012   2   1024    10    
AVAILABILITYZONE    |- c1.xlarge    0006 / 0006   2   2048    10    
AVAILABILITYZONE    |- m2.xlarge    0006 / 0006   2   2048    10    
AVAILABILITYZONE    |- m3.xlarge    0006 / 0006   4   2048    15    
AVAILABILITYZONE    |- m2.2xlarge   0003 / 0003   2   4096    30    
AVAILABILITYZONE    |- m3.2xlarge   0003 / 0003   4   4096    30    
AVAILABILITYZONE    |- cc1.4xlarge  0004 / 0004   8   3072    60    
AVAILABILITYZONE    |- m2.4xlarge   0003 / 0003   8   4096    60    
AVAILABILITYZONE    |- hi1.4xlarge  0002 / 0002   8   6144   120    
AVAILABILITYZONE    |- cc2.8xlarge  0002 / 0002  16   6144   120    
AVAILABILITYZONE    |- cg1.4xlarge  0001 / 0001  16   12288   200   
AVAILABILITYZONE    |- cr1.8xlarge  0000 / 0000  16   16384   240   
AVAILABILITYZONE    |- hs1.8xlarge  0000 / 0000  48   119808  24000 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Eucalyptus4 の WebUI ではマシンイメージから新規にインスタンスを起動する場合は、1セキュリティグループにつきインスタンスは10個までという制約があります。なんちゃらスタックやちょめちょめスタックとかでも似たような話を聴きますが、Eucalyptus でも同じような不具合があるんでしょうかね？&lt;/p&gt;

&lt;p&gt;いや、無い、無いと信じたい。伊達に他のほにゃららスタックらより叩かれまくってきたわけじゃないということを、今日ここで証明したい。&lt;/p&gt;

&lt;p&gt;脱線しました。で、1度に10インスタンスまでという制約があるのは新規の起動のときのみで、既存のインスタンスと同じ構成で起動する分には制約がありません。&lt;/p&gt;

&lt;p&gt;なので、昨日のエントリで起動した CirrOS インスタンスをそのまま流用します。エコです。&lt;/p&gt;

&lt;p&gt;では、インスタンスのプルダウンメニューから「Launch more like this」を選んで、一度に200インスタンスを起動してみようと思います。(「起動」って言っても OS の起動は失敗しているので、ズルい気もしますが気にしない)&lt;/p&gt;

&lt;p&gt;どどーん。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/eucalyptus.adventcalendar.2014.1215-01.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;インスタンス一覧に画面が遷移するところで Internal Server Error になりました。お約束すぎるwww&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/eucalyptus.adventcalendar.2014.1215-02.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ところがどっこい、しばらくしてからアクセスすると何と 94 インスタンスが起動に成功しています。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/eucalyptus.adventcalendar.2014.1215-03.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;で、他のインスタンスはどうしたのかと言うと、pending のままでした。&lt;/p&gt;

&lt;p&gt;何が起きているのかと Eucayptus 側の OS の syslog を見てみると、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Dec 14 23:29:56 euca4 dhcpd: No subnet declaration for vnet68 (no IPv4 addresses).
Dec 14 23:29:56 euca4 dhcpd: ** Ignoring requests on vnet68.  If this is not what
Dec 14 23:29:56 euca4 dhcpd:    you want, please write a subnet declaration
Dec 14 23:29:56 euca4 dhcpd:    in your dhcpd.conf file for the network segment
Dec 14 23:29:56 euca4 dhcpd:    to which interface vnet68 is attached. **
Dec 14 23:29:56 euca4 dhcpd: 
Dec 14 23:29:56 euca4 dhcpd: 
Dec 14 23:29:56 euca4 dhcpd: No subnet declaration for vnet67 (no IPv4 addresses).
Dec 14 23:29:56 euca4 dhcpd: ** Ignoring requests on vnet67.  If this is not what
Dec 14 23:29:56 euca4 dhcpd:    you want, please write a subnet declaration
Dec 14 23:29:56 euca4 dhcpd:    in your dhcpd.conf file for the network segment
Dec 14 23:29:56 euca4 dhcpd:    to which interface vnet67 is attached. **
Dec 14 23:29:56 euca4 dhcpd: 
Dec 14 23:29:56 euca4 dhcpd: 
Dec 14 23:29:56 euca4 rsyslogd-2177: imuxsock begins to drop messages from pid 23662 due to rate-limiting
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ってな感じで dhcpd が「定義が足んないんですけどぉ〜」って怒ってました。実際に /var/run/eucalyptus/net/euca-dhcp.conf を見ると 94 ホスト分しか定義が書かれてませんでした。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# cat /var/run/eucalyptus/net/euca-dhcp.conf | grep ^host | wc -l
94
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;逆を言えば、このファイルへの書き出しが上手く行っていたら、200台起動も夢じゃなかったということになりますでしょうかね。&lt;/p&gt;

&lt;p&gt;いやー、Eucalyptus 素晴しい。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cirros を Eucalyptus4 で動かしてみる</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-15-eucalyptus-advent-calendar-2014-14th/</link>
      <pubDate>Mon, 15 Dec 2014 12:28:49 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-15-eucalyptus-advent-calendar-2014-14th/</guid>
      <description>&lt;p&gt;今日は Cirros を Eucalyptus4 のインスタンスとして動かしてみようと思います。&lt;/p&gt;

&lt;p&gt;Eucalyptus3 のときは&lt;a href=&#34;https://www.eucalyptus.com/blog/2014/02/02/cirros-perfect-machine-image-eucalyptus-cloud-debugging&#34;&gt;こんな風&lt;/a&gt;に eustore コマンドを使って簡単にインストールできてたのですが、残念ながら Eucalyptus4 では eustore コマンドは廃止されたようです。&lt;/p&gt;

&lt;p&gt;なので、Eucalyptus4 では手動で入れてみますが、特に難しい作業ではありません。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;(イメージファイルをダウンロードします)
# wget http://download.cirros-cloud.net/0.3.1/cirros-0.3.1-x86_64-disk.img
(ファイル形式が qcow2 なので raw 形式に変換します)
# file cirros-0.3.1-x86_64-disk.img 
cirros-0.3.1-x86_64-disk.img: Qemu Image, Format: Qcow , Version: 2
# qemu-img convert -O raw cirros-0.3.1-x86_64-disk.img cirros-0.3.1-x86_64-disk.raw
(Eucalyptus に登録します)
# euca-install-image -b cirros031 -r x86_64 -i cirros-0.3.1-x86_64-disk.raw -n cirros031 --virtualization-type hvm
/var/tmp/bundle-O0s4JM/cirros-0.3.1-x86_64-disk.raw.part.00 100% |===================|  10.00 MB  25.81 MB/s Time: 0:00:00
/var/tmp/bundle-O0s4JM/cirros-0.3.1-x86_64-disk.raw.part.01 100% |===================|   1.81 MB   7.52 MB/s Time: 0:00:00
/var/tmp/bundle-O0s4JM/cirros-0.3.1-x86_64-disk.raw.manifest.xml 100% |==============|   3.49 kB   1.61 kB/s Time: 0:00:02
IMAGE   emi-b27ea8b4
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以上であっという間に完了です。あとはインスタンスを起動するだけです。&lt;/p&gt;

&lt;p&gt;……が、インスタンスのコンソールを確認すると、以下のような出力が延々て出続け、起動が成功しませんでした。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;SeaBIOS (version seabios-0.6.1.2-28.el6)


Machine UUID e0c370a4-513a-c61d-c8f3-398b3c25420d






gPXE (http://etherboot.org) - 00:03.0 C100 PCI2.10 PnP BBS PMM01E0@10 C100


Press Ctrl-B to configure gPXE (PCI 00:03.0)...







Booting from Hard Disk...


GRUB Loading stage1.5.






GRUB loading, please wait...



Starting up ...


ogle, Inc.
Serial Graphics Adapter 12/07/11
SGABIOS $Id: sgabios.S 8 2010-04-22 00:03:40Z nlaredo $ (mockbuild@c6b18n1.dev.centos.org) Wed Dec  7 17:04:47 UTC 2011
Term: 80x24
4 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ということで、見事に失敗している様子です。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>CoreOS on Eucalyptus4</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-12-coreos-on-eucalyptus4/</link>
      <pubDate>Fri, 12 Dec 2014 02:16:33 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-12-coreos-on-eucalyptus4/</guid>
      <description>&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/547&#34;&gt;Eucalyptus Advent Calendar 2014&lt;/a&gt; の12日目のエントリです。昨日は私のエントリ「&lt;a href=&#34;http://blog.osamu.habuka.jp/blog/2014/12/11/eucalyptus-advent-calendar-2014-11th/&#34;&gt;Eucalyptus4 でインスタンスタイプのパラメータを変更する方法&lt;/a&gt;」でした。&lt;/p&gt;

&lt;p&gt;小ネタというより「マニュアルを紹介した」程度でしたが、今日もそんな感じです。&lt;/p&gt;

&lt;p&gt;今日は CoreOS を Eucalyptus4 で動かしてみるという内容ですが、CoreOS の公式ドキュメントの &lt;a href=&#34;https://coreos.com/docs/running-coreos/platforms/eucalyptus/&#34;&gt;Running CoreOS on Eucalyptus 3.4&lt;/a&gt; を参考にして進めます。&lt;/p&gt;

&lt;p&gt;まぁ、公式ドキュメントに書いてあるように、簡単なことしかしません。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;(OpenStack 用のイメージファイルを取得して解凍)
# wget http://stable.release.core-os.net/amd64-usr/current/coreos_production_openstack_image.img.bz2
# bunzip2 coreos_production_openstack_image.img.bz2
(ファイル形式は qcow2 形式なので、raw 形式に変換する)
# file coreos_production_openstack_image.img
coreos_production_openstack_image.img: Qemu Image, Format: Qcow , Version: 2
# qemu-img convert -O raw coreos_production_openstack_image.img coreos_production_openstack_image.raw
(公式ドキュメントでは Eucalyptus 3 系だったので 3 つのコマンドを利用しているが、Eucalyptus 4 系からは1コマンドで処理可能)
# euca-install-image -b coreos -r x86_64 -i coreos_production_openstack_image.raw -n coreos --virtualization-type hvm
/var/tmp/bundle-BRRcnG/coreos_production_openstack_image.raw.part.00 100% |=========================================================|  10.00 MB   8.00 MB/s Time: 0:00:01
(中略)
/var/tmp/bundle-BRRcnG/coreos_production_openstack_image.raw.manifest.xml 100% |====================================================|   6.39 kB   2.81 kB/s Time: 0:00:02
IMAGE   emi-c3cd53c4
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あとは登録されたマシンイメージを使ってインスタンスを起動するだけです。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ssh -i ~/euca4_20141203.pem core@192.168.122.246
The authenticity of host &#39;192.168.122.246 (192.168.122.246)&#39; can&#39;t be established.
ED25519 key fingerprint is 43:6c:bd:63:0e:35:2b:b8:98:95:4f:8b:f6:22:80:78.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;192.168.122.246&#39; (ED25519) to the list of known hosts.
CoreOS (stable)
core@192 ~ $
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;やったー  :)&lt;/p&gt;

&lt;p&gt;メモリの消費量が 114MB 程度だと言うので、起動後のメモリを見てみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;core@192 ~ $ free -m
             total       used       free     shared    buffers     cached
Mem:           494        113        380          0          3         70
-/+ buffers/cache:         39        454
Swap:            0          0          0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;おぉ、確かに。では、次にキャッシュらを解放してみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;core@192 ~ $ sudo sysctl -w vm.drop_caches=3
vm.drop_caches = 3
core@192 ~ $ free -m
             total       used       free     shared    buffers     cached
Mem:           494         62        431          0          0         25
-/+ buffers/cache:         36        457
Swap:            0          0          0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;64MB 以下ですね。小さい。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ということで、Eucalyptus Advent Calendar は絶賛募集中です。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus4 でインスタンスタイプのパラメータを変更する方法</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-11-eucalyptus-advent-calendar-2014-11th/</link>
      <pubDate>Thu, 11 Dec 2014 02:47:38 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-11-eucalyptus-advent-calendar-2014-11th/</guid>
      <description>

&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/547&#34;&gt;Eucalyptus Advent Calendar 2014&lt;/a&gt; の11日目のエントリです。昨日は &lt;a href=&#34;https://twitter.com/giraffeforestg&#34;&gt;@giraffeforestg&lt;/a&gt; さんの「&lt;a href=&#34;http://giraffeforestg.blog.fc2.com/blog-entry-196.html&#34;&gt;Eucalyptus 4 の VMware Supportについて調べてみる&lt;/a&gt; 」でした。&lt;/p&gt;

&lt;p&gt;体当たりで調べてくださってありがとうございます。そうなんです、Eucalyptus にはサブスクリプションを購入しないと使えない機能がいくつかあります。&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&#34;インスタンスタイプの値を変更してみる&#34;&gt;インスタンスタイプの値を変更してみる&lt;/h3&gt;

&lt;p&gt;今日はまた小ネタですが Eucalyptus 4 でインスタンスタイプの値を変更する方法について紹介します。&lt;/p&gt;

&lt;p&gt;Eucalyptus はバージョン2系頃までは管理者用の WebUI がありました(評判は良くなかったですが)。でも Eucalyptus 3 から管理者用の画面が綺麗になり、そして Eucalyptus 4 では管理者用の WebUI が消えたように見えます。(少なくとも見当りません)&lt;/p&gt;

&lt;p&gt;じゃー、インスタンスタイプはどこで変更するんだ？という疑問がわきまして、本家のドキュメントを見ると &lt;a href=&#34;https://www.eucalyptus.com/docs/euca2ools/3.0/euca2ools-guide/euca-modify-instance-type.html&#34;&gt;euca-modify-instance-type&lt;/a&gt; というコマンドが増えていました。ちなみにインスタンスタイプの一覧は &lt;a href=&#34;https://www.eucalyptus.com/docs/euca2ools/3.0/euca2ools-guide/euca-describe-instance-types.html&#34;&gt;euca-describe-instance-types&lt;/a&gt; コマンドで出ます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# euca-describe-instance-types 
INSTANCETYPE    Name         CPUs  Memory (MiB)  Disk (GiB)
INSTANCETYPE    m1.small        1           256           5
INSTANCETYPE    t1.micro        1           256           5
INSTANCETYPE    m1.medium       1           512          10
INSTANCETYPE    c1.medium       2           512          10
INSTANCETYPE    m1.large        2           512          10
INSTANCETYPE    m1.xlarge       2          1024          10
INSTANCETYPE    c1.xlarge       2          2048          10
INSTANCETYPE    m2.xlarge       2          2048          10
INSTANCETYPE    m3.xlarge       4          2048          15
INSTANCETYPE    m2.2xlarge      2          4096          30
INSTANCETYPE    m3.2xlarge      4          4096          30
INSTANCETYPE    cc1.4xlarge     8          3072          60
INSTANCETYPE    m2.4xlarge      8          4096          60
INSTANCETYPE    hi1.4xlarge     8          6144         120
INSTANCETYPE    cc2.8xlarge    16          6144         120
INSTANCETYPE    cg1.4xlarge    16         12288         200
INSTANCETYPE    cr1.8xlarge    16         16384         240
INSTANCETYPE    hs1.8xlarge    48        119808       24000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ということで、早速 m1.small をメモリ 32MB、ディスク 1GB にしてみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# euca-modify-instance-type -d 1 -m 32 m1.small
INSTANCETYPE    m1.small    1   32  1

# euca-describe-instance-types m1.small
INSTANCETYPE    Name      CPUs  Memory (MiB)  Disk (GiB)
INSTANCETYPE    m1.small     1            32           1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あら簡単。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ということで、Eucalyptus Advent Calendar は絶賛募集中です。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus4 のダッシュボードの見た目を変えてみる</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-09-eucalyptus-advent-calendar-2014-9th/</link>
      <pubDate>Tue, 09 Dec 2014 23:05:42 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-09-eucalyptus-advent-calendar-2014-9th/</guid>
      <description>&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/547&#34;&gt;Eucalyptus Advent Calendar 2014&lt;/a&gt; の9日目のエントリです。昨日は私のエントリ「&lt;a href=&#34;http://blog.osamu.habuka.jp/blog/2014/12/08/eucalyptus-advent-calendar-2014-8th/&#34;&gt;Eucalyptus 環境を再起動後にインスタンスが起動しなくなったら&lt;/a&gt;」でした。&lt;/p&gt;

&lt;p&gt;今日のエントリは Eucalyptus Advent Calendar 2012 JP の13日目の私のエントリ「&lt;a href=&#34;http://blog.osamu.habuka.jp/blog/2012/12/13/eucalyptus-advent-calendar-2012-jp-13th/&#34;&gt;Eucalyptus Advent Calendar 2012 JP 十三日目&lt;/a&gt;」を思い出したので、Eucalyptus 4 のダッシュボードの見た目も変更してみようと思います。&lt;/p&gt;

&lt;p&gt;といってもあまり難しいことありません。CentOS 6.5 の場合、ダッシュボードである eucaconsole の実体は /usr/lib/python2.6/site-packages/eucaconsole/ 配下にありまして、たとえば css をイジる場合は /usr/lib/python2.6/site-packages/eucaconsole/static/css/ 配下にあるファイルをイジります。&lt;/p&gt;

&lt;p&gt;ということで、ちょちょいと変更した結果、&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/eucalyptus.adventcalendar.2014.1209-01.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;が&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/eucalyptus.adventcalendar.2014.1209-02.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;って感じになりました。おしまい。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus 環境を再起動後にインスタンスが起動しなくなったら</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-07-eucalyptus-advent-calendar-2014-8th/</link>
      <pubDate>Mon, 08 Dec 2014 01:06:53 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-07-eucalyptus-advent-calendar-2014-8th/</guid>
      <description>&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/547&#34;&gt;Eucalyptus Advent Calendar 2014&lt;/a&gt; の8日目のエントリです。昨日は &lt;a href=&#34;https://twitter.com/giraffeforestg&#34;&gt;@giraffeforestg&lt;/a&gt; さんの「&lt;a href=&#34;http://giraffeforestg.blog.fc2.com/blog-entry-195.html&#34;&gt;Eucalyptus 4 の AUTO SCALING機能を使ってみる&lt;/a&gt; 」でした。&lt;/p&gt;

&lt;p&gt;いつも &lt;a href=&#34;https://twitter.com/giraffeforestg&#34;&gt;@giraffeforestg&lt;/a&gt; さんのアドベントカレンダー投稿数に驚いてますが、今年の量は更にヤバイですね。でも、おかげで助けてもらったり励みになったりしてます、ありがとうございます。&lt;/p&gt;

&lt;p&gt;さて、今日のエントリは「Eucalyptus 環境を再起動後にインスタンスが起動しなくなったら」です。&lt;/p&gt;

&lt;p&gt;実は、今回の Advent Calendar で使用している faststart で作った私の Eucalyptus 環境は、KVM のゲスト OS 上で動いているのですが、VM を再起動した後にインスタンスを起動しようとすると以下の画面のように「Not enough resources (0 in &amp;lt; 1): vm instances.」というツレないメッセージが出力されます。で、画面を見て頂くとわかりますが、インスタンスリストには「No items were found」って出ているように、リソースなんて全然枯渇してないはずなんです。&lt;/p&gt;

&lt;p&gt;本当にリソースないの？って思って CLI 叩いて確認すると、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# euca-describe-availability-zones verbose
AVAILABILITYZONE    default 192.168.122.115 arn:euca:eucalyptus:default:cluster:default-cc-1/   
AVAILABILITYZONE    |- vm types free / max   cpu   ram  disk    
AVAILABILITYZONE    |- m1.small 0000 / 0000   1    256     5    
AVAILABILITYZONE    |- t1.micro 0000 / 0000   1    256     5    
AVAILABILITYZONE    |- m1.medium    0000 / 0000   1    512    10    
AVAILABILITYZONE    |- c1.medium    0000 / 0000   2    512    10    
AVAILABILITYZONE    |- m1.large 0000 / 0000   2    512    10    
AVAILABILITYZONE    |- m1.xlarge    0000 / 0000   2   1024    10    
AVAILABILITYZONE    |- c1.xlarge    0000 / 0000   2   2048    10    
AVAILABILITYZONE    |- m2.xlarge    0000 / 0000   2   2048    10    
AVAILABILITYZONE    |- m3.xlarge    0000 / 0000   4   2048    15    
AVAILABILITYZONE    |- m2.2xlarge   0000 / 0000   2   4096    30    
AVAILABILITYZONE    |- m3.2xlarge   0000 / 0000   4   4096    30    
AVAILABILITYZONE    |- cc1.4xlarge  0000 / 0000   8   3072    60    
AVAILABILITYZONE    |- m2.4xlarge   0000 / 0000   8   4096    60    
AVAILABILITYZONE    |- hi1.4xlarge  0000 / 0000   8   6144   120    
AVAILABILITYZONE    |- cc2.8xlarge  0000 / 0000  16   6144   120    
AVAILABILITYZONE    |- cg1.4xlarge  0000 / 0000  16   12288   200   
AVAILABILITYZONE    |- cr1.8xlarge  0000 / 0000  16   16384   240   
AVAILABILITYZONE    |- hs1.8xlarge  0000 / 0000  48   119808  24000 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あらやだ、本当にリソースゼロですよwww&lt;/p&gt;

&lt;p&gt;NC ちゃん大丈夫？息してる？と思って確認すると&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# euca-describe-nodes 
NODE    default     192.168.122.115 DISABLED    
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;って出力されます。そもそも CC から見て NC が無効になっているという罠。&lt;/p&gt;

&lt;p&gt;NC のログを見ると、とかく「failed だかんね」の一点張り。もうちょっと理由を述べてくれてもいいのに…&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# tail /var/log/eucalyptus/nc.log 
2014-12-06 17:32:22 ERROR | failed error=1
2014-12-06 17:32:23 ERROR | failed error=1
2014-12-06 17:32:29 ERROR | failed error=1
2014-12-06 17:32:35 ERROR | failed error=1
2014-12-06 17:32:42 ERROR | failed error=1
2014-12-06 17:32:42 ERROR | failed error=1
2014-12-06 17:32:48 ERROR | failed error=1
2014-12-06 17:32:51 ERROR | failed error=1
2014-12-06 17:32:54 ERROR | failed error=1
2014-12-06 17:33:00 ERROR | failed error=1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;CC のログを見ると、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# tail /var/log/eucalyptus/cc.log 
2014-12-06 17:33:00 ERROR | error message from ncDescribeResource: NULL parameter was passed when a non NULL parameter was expected
2014-12-06 17:33:02  INFO | modifying node 192.168.122.115 with state=enabled
2014-12-06 17:33:02 ERROR | returned an error
2014-12-06 17:33:02ERROR: doEnableService() returned FAIL
2014-12-06 17:33:06 ERROR | operation on 192.168.122.115 could not be invoked (check NC host, port, and credentials): NULL parameter was passed when a non NULL parameter was expected
2014-12-06 17:33:06 ERROR | bad return from ncDescribeResource(192.168.122.115) (1)
2014-12-06 17:33:06 ERROR | error message from ncDescribeResource: NULL parameter was passed when a non NULL parameter was expected
2014-12-06 17:33:12 ERROR | operation on 192.168.122.115 could not be invoked (check NC host, port, and credentials): NULL parameter was passed when a non NULL parameter was expected
2014-12-06 17:33:12 ERROR | bad return from ncDescribeResource(192.168.122.115) (1)
2014-12-06 17:33:12 ERROR | error message from ncDescribeResource: NULL parameter was passed when a non NULL parameter was expected
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;CC は CC で「NC がちゃんと応答しないぜコンチキショウ」と言ってやがります。「modifying node 192.168.122.115 with state=enabled」って実行してるっぽいのに、NC は無効なまま。&lt;/p&gt;

&lt;p&gt;仕方ないので、とりあえず NC を再起動してみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# /etc/init.d/eucalyptus-nc restart
Restarting Eucalyptus services: done.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、もう一度 NC の状況を確認すると…&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# euca-describe-nodes 
NODE    default     192.168.122.115 ENABLED 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;おぉ、今度はちゃんと有効になっていますね。そーすると、リソースも…？&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# euca-describe-availability-zones verbose
AVAILABILITYZONE    default 192.168.122.115 arn:euca:eucalyptus:default:cluster:default-cc-1/   
AVAILABILITYZONE    |- vm types free / max   cpu   ram  disk    
AVAILABILITYZONE    |- m1.small 0019 / 0019   1    256     5    
AVAILABILITYZONE    |- t1.micro 0019 / 0019   1    256     5    
AVAILABILITYZONE    |- m1.medium    0009 / 0009   1    512    10    
AVAILABILITYZONE    |- c1.medium    0009 / 0009   2    512    10    
AVAILABILITYZONE    |- m1.large 0009 / 0009   2    512    10    
AVAILABILITYZONE    |- m1.xlarge    0007 / 0007   2   1024    10    
AVAILABILITYZONE    |- c1.xlarge    0003 / 0003   2   2048    10    
AVAILABILITYZONE    |- m2.xlarge    0003 / 0003   2   2048    10    
AVAILABILITYZONE    |- m3.xlarge    0003 / 0003   4   2048    15    
AVAILABILITYZONE    |- m2.2xlarge   0001 / 0001   2   4096    30    
AVAILABILITYZONE    |- m3.2xlarge   0001 / 0001   4   4096    30    
AVAILABILITYZONE    |- cc1.4xlarge  0001 / 0001   8   3072    60    
AVAILABILITYZONE    |- m2.4xlarge   0001 / 0001   8   4096    60    
AVAILABILITYZONE    |- hi1.4xlarge  0000 / 0000   8   6144   120    
AVAILABILITYZONE    |- cc2.8xlarge  0000 / 0000  16   6144   120    
AVAILABILITYZONE    |- cg1.4xlarge  0000 / 0000  16   12288   200   
AVAILABILITYZONE    |- cr1.8xlarge  0000 / 0000  16   16384   240   
AVAILABILITYZONE    |- hs1.8xlarge  0000 / 0000  48   119808  24000 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;やったー、ちゃんとリソースも復活！&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ということで、8日目のエントリでした。9日目のエントリもお楽しみに。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>eucalyptuscala を試してみる</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-05-try-out-the-eucalyptuscala/</link>
      <pubDate>Fri, 05 Dec 2014 23:50:28 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-05-try-out-the-eucalyptuscala/</guid>
      <description>&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/547&#34;&gt;Eucalyptus Advent Calendar 2014&lt;/a&gt; の5日目のエントリです。昨日は &lt;a href=&#34;https://twitter.com/giraffeforestg&#34;&gt;@giraffeforestg&lt;/a&gt; さんの「&lt;a href=&#34;http://giraffeforestg.blog.fc2.com/blog-entry-189.html&#34;&gt;Eucalyptus から AWS を管理してみる&lt;/a&gt; でした。&lt;/p&gt;

&lt;p&gt;今日のエントリは3日目の &lt;a href=&#34;https://twitter.com/tanacasino&#34;&gt;@tanacasino&lt;/a&gt; さんのエントリ「&lt;a href=&#34;http://tanacasino.hatenablog.com/entry/2014/12/03/003900&#34;&gt;Eucalyptus meets Scala !? Scala meets Eucalytpus!?&lt;/a&gt;」を参考に eucalyptuscala を使ってみようと思います。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;scala&amp;gt; euca.describeImages
res2: com.amazonaws.services.ec2.model.DescribeImagesResult = {Images: [{ImageId: emi-dfe169b4,ImageLocation: ubuntu-12.04.4/ubuntu.raw.manifest.xml,State: available,OwnerId: 952671494305,Public: false,ProductCodes: [],Architecture: x86_64,ImageType: machine,Platform: ,Name: ubuntu-12.04.4,RootDeviceType: instance-store,RootDeviceName: /dev/sda1,BlockDeviceMappings: [],VirtualizationType: hvm,Tags: [],}]}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;おぉ、イメージ ID が取得できますね。&lt;/p&gt;

&lt;p&gt;次にインスタンスを起動してみようと思います…が、どうやたらいいのかさっぱりわかりません。AWScala ってリファレンスないんすか？(← ヘタレ)&lt;/p&gt;

&lt;p&gt;とりあえず、引数なしで叩いてみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;scala&amp;gt; euca.runInstances()
&amp;lt;console&amp;gt;:12: error: not enough arguments for method runInstances: (x$1: com.amazonaws.services.ec2.model.RunInstancesRequest)com.amazonaws.services.ec2.model.RunInstancesResult.
Unspecified value parameter x$1.
              euca.runInstances()
                               ^
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;なんか RunInstancesRequest な型で渡せということでしょうかね？&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;scala&amp;gt; euca.runInstances(com.amazonaws.services.ec2.model.RunInstancesRequest(&amp;quot;emi-dfe169b4&amp;quot;, 1, 1))
&amp;lt;console&amp;gt;:12: error: object com.amazonaws.services.ec2.model.RunInstancesRequest is not a value
              euca.runInstances(com.amazonaws.services.ec2.model.RunInstancesRequest(&amp;quot;emi-dfe169b4&amp;quot;, 1, 1))
                                                                 ^
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ん？値じゃないって？じゃぁ…こう？&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;scala&amp;gt; euca.runInstances(new com.amazonaws.services.ec2.model.RunInstancesRequest(&amp;quot;emi-dfe169b4&amp;quot;, 1, 1))
res11: com.amazonaws.services.ec2.model.RunInstancesResult = {Reservation: {ReservationId: r-dadc5b05,OwnerId: 952671494305,Groups: [{GroupName: default,GroupId: sg-4f9f263b}],GroupNames: [default],Instances: [{InstanceId: i-7933764d,ImageId: emi-dfe169b4,State: {Code: 0,Name: pending},PrivateDnsName: 192.168.122.242,PublicDnsName: 192.168.122.242,StateTransitionReason: NORMAL:  -- [],AmiLaunchIndex: 0,ProductCodes: [],InstanceType: m1.small,LaunchTime: Sat Dec 06 17:34:57 JST 2014,Placement: {AvailabilityZone: default,},Monitoring: {State: disabled},PrivateIpAddress: 192.168.122.242,PublicIpAddress: 192.168.122.242,Architecture: x86_64,RootDeviceType: instance-store,RootDeviceName: /dev/sda1,BlockDeviceMappings: [],VirtualizationType: hvm,ClientToken: 860b57f0-43f6-4099-b2a1-5749d63336...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;おぉっ！&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/eucalyptus.adventcalendar.2014.1205-01.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;おぉぉ！！ってことで無事起動できました。やったー。&lt;/p&gt;

&lt;p&gt;ということで、途中から次の日になってしまいましたが、euca.runInstances() にどうやって値を渡せばよいのかを悩んでいるうちに日付が変わってしまいましたwww&lt;/p&gt;

&lt;p&gt;ちなみに AWScala の runInstances() のことを説明しているドキュメントとかリファレンスがどこにあるのかさっぱりわからないので、とりあえず&lt;a href=&#34;https://github.com/seratch/AWScala/blob/develop/src/main/scala/awscala/ec2/Requests.scala#L6-L7&#34;&gt;コード&lt;/a&gt;を見てみると以下のように書いてあります。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;package awscala.ec2

import scala.collection.JavaConverters._
import com.amazonaws.services.{ ec2 =&amp;gt; aws }

case class RunInstancesRequest(imageId: String, min: Int = 1, max: Int = 1)
    extends aws.model.RunInstancesRequest(imageId, min, max) {

  // TODO set...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;さて、インスタンスタイプとかユーザデータとかセキュリティグループとかゾーンとかはどうやって渡せばいいんだろう？これは ec2.model.RunInstancesRequest じゃなく aws.model.RunInstancesRequest を見ないといけないのでしょうけれど、僕は Scala を全く知らないので諦めることにします。:)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ということで、6日目になってしまった5日目のエントリでした。6日目のエントリは @shida1234 さんです。お楽しみに。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>JEUGのML終了に寄せて</title>
      <link>http://blog.osamu.habuka.jp/post/2014-08-27-requiem-for-closing-jegu-ml/</link>
      <pubDate>Thu, 21 Aug 2014 20:32:33 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-08-27-requiem-for-closing-jegu-ml/</guid>
      <description>

&lt;h2 id=&#34;投稿数のまとめ&#34;&gt;投稿数のまとめ&lt;/h2&gt;

&lt;p&gt;本日 Eucalyptus Users Group Japan の ML に終了のおしらせをポストしましたが、折角なので「いったい僕はどのぐらいこの ML に投稿したんだろうか？」と思いグラフを描いてみました。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/20140821_1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;2012年以降は全体のポスト数が激減したために、全体のポスト数 = 自分のポスト数になることがありますが、5年間を通して見るとそんなに投稿してませんね。&lt;/p&gt;

&lt;p&gt;Web で連載を開始した &lt;sup&gt;2010&lt;/sup&gt;&amp;frasl;&lt;sub&gt;09&lt;/sub&gt; が丁度ポスト数が落ち込んだ最初の谷で、ちょうど連載の1回目が公開される前後数ヶ月の間に CloudStack&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:1&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; やら OpenStack やらがリリースされて、みんなの興味がそっちに移った時期でもありました。&lt;/p&gt;

&lt;p&gt;あとは何気に 2011 年以降は告知系のポストがメインとなっていき、流れても1～2通/月という状況でした。そして今頃気付きましたが、自分の書籍の告知を ML に流してなかったんですね…。もうこの頃には告知系はほとんど Twitter でツブやいていたのも流量が減った一因かもしれません。&lt;/p&gt;

&lt;p&gt;&lt;sup&gt;2012&lt;/sup&gt;&amp;frasl;&lt;sub&gt;12&lt;/sub&gt; に全体のポスト数と自分のポスト数が完全一致しているのは、AdventCalendar をやった時期だったため、一人でモクモクと狂気じみたポストをしていたせいです。とは言ってもたかが数ポストですが。&lt;/p&gt;

&lt;p&gt;2013年や2014年にたまにスパイクが現われますが、こちらは珍しく技術的な投稿だったんですが私が全然反応できなくて申し訳ないことをしたと思ってます。&lt;/p&gt;

&lt;p&gt;ということで 5年間という歴史のわりにはポスト数の少なかった ML ですが、今日の ML への投稿にも書いたようにこの ML は私が人前で OSS 活動をすることになった最初の場所でもあったので、ML 終了の決意を何割か…いやほとんどを決めた身とは言え、需要が無く閉鎖するのは胸がしめつけられる気持ちもあります。&lt;/p&gt;

&lt;p&gt;ただ、投稿にも書いたように、このまま需要がない ML をだらだらと運用するのはコスト面でも辛いので、やはりどこかで幕を引かなきゃいけなかったという意味では、今日が良いタイミングだったと思います。写真を撮る余裕がありませんでしたが、今日の東京の空は良い天気だったので、最後を送るにはそういう意味でも良い日でした。&lt;/p&gt;

&lt;p&gt;投稿にも書きましたが、肝付さん前佛さんお疲れさまでした。&lt;/p&gt;

&lt;p&gt;あ！終了するのは ML であって、&lt;strong&gt;Users Group はまだ存続してます&lt;/strong&gt;よーーーー&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;実装自体は別の名前で前から出ていたけど、この名前でリリースされたのが 2010 年だったような…
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:1&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus Advent Calendar 2013 5日目</title>
      <link>http://blog.osamu.habuka.jp/post/2013-12-05.AdventCalendar-day-5/</link>
      <pubDate>Thu, 05 Dec 2013 01:11:41 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2013-12-05.AdventCalendar-day-5/</guid>
      <description>

&lt;h1 id=&#34;緑&#34;&gt;緑&lt;/h1&gt;

&lt;p&gt;さて、今日はとうとう「緑」に関する名前で誕生日な人を見つけることができませんでした。&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:1&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;なので、苦肉の策？として、「緑」という言葉に関して、ちょっぴりググってしまいました。というのも、これだけ好きな色なのに、語源を知らなかったからです。&lt;/p&gt;

&lt;p&gt;「みどり」という言葉が登場するのは平安時代になってからだそうです。へー。では、それまでは緑色のことを何て呼んでたんでしょうかね？ちょっと僕の浅い検索力では調べられませんでした。&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;だから時間切れになってしまい、本日のエントリを12/5中に公開することができませんでした(；´Д`A
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:1&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus Advent Calendar 2013 JP 4日目</title>
      <link>http://blog.osamu.habuka.jp/post/2013-12-04.AdventCalendar-day-4/</link>
      <pubDate>Wed, 04 Dec 2013 01:11:29 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2013-12-04.AdventCalendar-day-4/</guid>
      <description>

&lt;h1 id=&#34;菅緑&#34;&gt;菅緑&lt;/h1&gt;

&lt;p&gt;皆さん、遊園地とかの絶叫系マシンは好きですか？私は大嫌いです。何で金を出して怖い目にあわないといけないんでしょうかね？ちっとも理解できません。ちなみに私の妻は絶叫系マシンが大好きなので、遊園地に行くときはいつも寿命が年単位で縮んでいます。だぶんこのままだと私の戒名は緑毒草子守熊絶叫居士とかになりそうです。&lt;/p&gt;

&lt;p&gt;はい、どうでもいい個人的な話から始めてしまいました今日12/4は熊本出身で第2日本テレビの元アナウンサー&lt;a href=&#34;http://ja.wikipedia.org/wiki/%E8%8F%85%E7%B7%91&#34;&gt;菅緑&lt;/a&gt;さんの誕生日です。全く存じあげない人(をお祝いするというのは、かなり変な行為だということは重々承知のうえ)ですが、お誕生日おめでとうございます。&lt;/p&gt;

&lt;h1 id=&#34;eucalyptus-1-6-2-で-clc-がなかなか起動しないことがあったという話&#34;&gt;Eucalyptus 1.6.2 で CLC がなかなか起動しないことがあったという話&lt;/h1&gt;

&lt;p&gt;えーと、本題です。普段仕事で使うプライベートクラウドに Eucalyptus 1.6.2 相当のものを使っているのですが、今日触っていたらどうも様子が変だということでログを見ていました。&lt;/p&gt;

&lt;p&gt;そしたら定期的にスタックトレースを吐いている様子で、ちょっと原因追求する暇も余力もないから、やってはいけないと思いつつ、背に腹はかえられぬということで、エイヤッと CLC を再起動しました。&lt;/p&gt;

&lt;p&gt;するとですね、cloud-debug.log に&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2013/12/03 21:58:35  WARN [GroovyUtil:GroovyUtil:loadConfig:91:main] javax.script.ScriptException: javax.script.ScriptException: java.lang.N
ullPointerException
javax.script.ScriptException: javax.script.ScriptException: java.lang.NullPointerException
        at org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.eval(GroovyScriptEngineImpl.java:119)
        at javax.script.AbstractScriptEngine.eval(AbstractScriptEngine.java:264)
        at com.eucalyptus.util.GroovyUtil.loadConfig(GroovyUtil.java:89)
(中略)
        at org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.eval(GroovyScriptEngineImpl.java:113)
        ... 76 more
Caused by: java.lang.NullPointerException
        at org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.eval(GroovyScriptEngineImpl.java:253)
        ... 77 more
2013/12/03 21:58:48  WARN [Environment:Environment:verifyProperties:532:main] Property [hibernate.cglib.use_reflection_optimizer] has been renamed to [hibernate.bytecode.use_reflection_optimizer]; update your properties appropriately
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ってな感じのログが吐かれて、そのままピタっとログ出力が止まったまま、起動処理が進まなくなる現象が発生しました。自分しか使ってない環境なら、まぁそんなに慌てないんですが、Eucalyptus 1.6.2 です、そりゃぁもう使ってきた歴史がそれなりに長いわけでして、みんなこの環境に頼りまくりです。&lt;/p&gt;

&lt;p&gt;もうね同僚のみなさんが「OpenStack すげーイカしてるー、しびれるわー」とか言ってても、何だかんだで Eucalyptus 1.6.2 のインスタンス上で動く Redmine でバグ管理とかしているんですよ、もう私は心の中でニヤリなわけでして…って何の話だ？&lt;/p&gt;

&lt;p&gt;ということで、このままだと OpenStacker な同僚から「ちっ、羽深だけじゃなくて Eucalyptus も使えねーなー」とか蔑まれちゃうこと間違いなしですよ。もうね、焦って焦って色々と見ます。下手したら焦りすぎてテンパりだして、別環境を構築して手動マイグレーションしちゃおうかとか考えだす始末です。&lt;/p&gt;

&lt;p&gt;いくら &lt;font size=&#34;5&#34;&gt;Eucalyptus が「環境を構築し易い」&lt;/font&gt;とは言え、トラブル対応放っておいて環境構築をやっちゃ駄目ですよね。&lt;/p&gt;

&lt;p&gt;で、基本として /etc/eucalyptus/, /var/lib/eucalyptus/, /var/log/eucalyptus/ 配下をチェックしていくんですが、ふと違和感を感じました。/var/lib/eucalyptus/db/ 配下を見ると…&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;-rw-r--r--  1 root       root         20G Dec  3 21:58 eucalyptus_general.log
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;とかってデカいのが居るわけですよ。普段このファイルがそんなに大きくなっているのを見てないので、ちょっとビビります。で、このファイル、そんなに肥大化すんだっけ？と思ってバグチケットに何か情報ないかと検索してみたところ…&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://gyazo.com/636b0cdfa998f0e7a6ead1406174a1b9&#34;&gt;http://gyazo.com/636b0cdfa998f0e7a6ead1406174a1b9&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;あれ？さすがにもう 1.6.2 の情報なんて世の中から消えさってしまったの？と不安を抱きながら漫画を読みながら、試行錯誤しているうちに、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;-rw-r--r--  1 root       root        154K Dec  3 23:06 eucalyptus_general.log
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あらやだ、ファイルが小さくなってる…&lt;/p&gt;

&lt;p&gt;で、再び cloud-debug.log を見てみると&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2013/12/03 22:11:43  WARN [Environment:Environment:verifyProperties:532:main] Property [hibernate.cglib.use_reflection_optimizer] has been r
enamed to [hibernate.bytecode.use_reflection_optimizer]; update your properties appropriately
2013/12/03 22:56:12  INFO [DatabaseUtil:DatabaseUtil:registerPersistenceContext:45:main] -&amp;gt; Setting up persistence context for : eucalyptus_
general
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;なんと、ログ出力が再開しているじゃないですか。えー、つまりですよ、CLC 君は hsqldb を起動してレスポンスが返ってくるのを待ち続けていただけという、つまりそーゆーこと？&lt;/p&gt;

&lt;p&gt;&lt;br/&gt;&lt;br/&gt;&lt;font size=&#34;5&#34; color=&#34;#ee2222&#34;&gt;クリスマスまであと21日です✌(́◓q◔`)✌&lt;/font&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus Advent Calendar 2013 JP 2日目</title>
      <link>http://blog.osamu.habuka.jp/post/2013-12-02.AdventCalendar-day-2/</link>
      <pubDate>Mon, 02 Dec 2013 01:11:25 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2013-12-02.AdventCalendar-day-2/</guid>
      <description>

&lt;h1 id=&#34;山本みどり&#34;&gt;山本みどり&lt;/h1&gt;

&lt;p&gt;年末の定番といえば特番の時代劇ですが、最近は時代劇を観る人があまり居ないんでしょうかね？&lt;/p&gt;

&lt;p&gt;僕が幼少の頃は祖母が子守をしてくれたんですが、祖母が観る番組ってドラマか時代劇かのどちらかでした。当然、僕も幼少の頃は時代劇を観て育つんですが、今も放映されているかどうか不明ですが、子供の頃によく観(せられ)ていた時代劇と言えば「桃太郎侍」「水戸黄門」「暴れん坊将軍」「遠山の金さん」「大岡越前」「銭形平次」など&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:1&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;でした。&lt;/p&gt;

&lt;p&gt;で、ふと気づいたんですが、上に挙げた時代劇全てに出演している女優さんが居ました。そう、女優の&lt;a href=&#34;http://www.sachikopro.co.jp/actress/yamamoto/yamamoto.html&#34;&gt;山本みどりさん&lt;/a&gt;です。すごいですね。&lt;/p&gt;

&lt;p&gt;そして本日12/2は山本みどりさんの誕生日です。おめでとうございます。&lt;/p&gt;

&lt;h1 id=&#34;walrus-をだけを使ってみる&#34;&gt;Walrus をだけを使ってみる&lt;/h1&gt;

&lt;p&gt;&lt;a href=&#34;http://036.habuka.jp/diary/?date=20121201&#34;&gt;去年は見事なまでの醜態&lt;/a&gt;を晒してしまいましたが、今年は頑張ります。&lt;/p&gt;

&lt;p&gt;さて、懇切丁寧に説明したいところですが、諸般の事情によりサクサク進めていきます。&lt;/p&gt;

&lt;p&gt;まずレポジトリ情報をインストールします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@walrus ~]# yum install http://downloads.eucalyptus.com/software/eucalyptus/3.4/centos/6/x86_64/eucalyptus-release-3.4.noarch.rpm
[root@walrus ~]# yum install http://downloads.eucalyptus.com/software/euca2ools/3.0/centos/6/x86_64/euca2ools-release-3.0.noarch.rpm
[root@walrus ~]# yum install http://downloads.eucalyptus.com/software/eucalyptus/3.4/centos/6/x86_64/epel-release-6.noarch.rpm
[root@walrus ~]# yum install http://downloads.eucalyptus.com/software/eucalyptus/3.4/centos/6/x86_64/elrepo-release-6.noarch.rpm
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;そして Walrus をインストールするんですが、Walrus を利用するには CloudController も必要不可欠なためインストールします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@walrus ~]# yum install eucalyptus-cloud eucalyptus-walrus
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;次にデータベースの初期化をして CloudController と Walrus を起動します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@walrus ~]# /usr/sbin/euca_conf --initialize
Initializing a new cloud.  This may take a few minutes.
Initialize command succeeded

[root@walrus ~]# /etc/init.d/eucalyptus-cloud start
Starting Eucalyptus services:
************************************************************************
  ERR-1008 2013-12-03 15:13:38Z ntp is not running

   Condition: Can&#39;t find running ntp process
       Cause: unknown
   Initiator: eucalyptus
    Location: ntp daemon on localhost
  Resolution:
        1) Install ntp
        2) Run ntp

************************************************************************

done.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;無事に起動したら Walrus のコンポーネントを登録します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@walrus ~]# /usr/sbin/euca_conf --register-walrus --partition walrus --host 192.168.32.73 --component walrus0
SERVICE walrus          walrus          walrus0         LOADED          26      http://192.168.32.74:8773/services/Walrus  arn:euca:bootstrap:walrus:walrus:walrus0/
The authenticity of host &#39;192.168.32.73 (192.168.32.73)&#39; can&#39;t be established.
RSA key fingerprint is 92:7c:d1:a1:49:25:ac:44:4e:c9:75:bd:ed:0b:57:95.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;192.168.32.73&#39; (RSA) to the list of known hosts.
root@192.168.32.73&#39;s password:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Walrus を使うための情報を取得します。ついでにダウンロードした情報を環境変数に取り込みます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@walrus ~]# mkdir -p .euca/admin/
[root@walrus ~]# cd .euca/admin/
[root@walrus admin]# euca_conf --get-credentials euca2-admin-x509.zip
[root@walrus admin]# unzip euca2-admin-x509.zip
Archive:  euca2-admin-x509.zip
To setup the environment run: source /path/to/eucarc
  inflating: eucarc
  inflating: iamrc
  inflating: cloud-cert.pem
  inflating: jssecacerts
  inflating: euca2-admin-d69abbe4-pk.pem
  inflating: euca2-admin-d69abbe4-cert.pem
[root@walrus admin]# source eucarc
WARN: Load Balancing service URL is not configured.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、ここで Cyberduck を使ってさくっと Walrus にバケットを作ってオブジェクトをアップロードする様をスクリーンショットを交えながら、ここで紹介しようとしたのですが、実はこの日記は設定を失敗してて画像をアップロードできないんです…orz&lt;/p&gt;

&lt;p&gt;というこで、別の方法で Walrus だけ使えることを紹介しようと思い、OpenStack の Glance の代わりに Walrus を使ってみようと思いますが、それはまた別の日に。&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;もちろん思い出せないだけで、他にも観てた時代劇があったと思います
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:1&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus Advent Calendar 2012 JP 十三日目</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-09-eucalyptus-advent-calendar-2012-jp-13th/</link>
      <pubDate>Thu, 13 Dec 2012 01:43:14 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-09-eucalyptus-advent-calendar-2012-jp-13th/</guid>
      <description>

&lt;h3 id=&#34;見た目大事&#34;&gt;見た目大事&lt;/h3&gt;

&lt;p&gt;13日目です。去年まで「Advent Calendar なんて他の国のリア充どもがやってんだろうなぁ～」ってぐらいしか思ってなかったんですが、まさか自分が当事者になるとは思いませんでした。まぁ、「1人1ネタぐらいで持ち寄って皆でワイワイやったら楽しいなぁ～ほわわぁぁん」とか思ってたのは &lt;sup&gt;11&lt;/sup&gt;&amp;frasl;&lt;sub&gt;30&lt;/sub&gt; までで、いざ始まってみると結構マゾいんすね Advent Calendar って。そんなマゾい Advent Calendar をやっている聖なる紳士淑女の皆さん元気ですか？こんばんは。&lt;/p&gt;

&lt;p&gt;で、Advent Calendar って 10 分で考えて 5 分で書くということを&lt;a href=&#34;http://d.hatena.ne.jp/yukutomi/20121211/1355185510&#34;&gt;先日知った&lt;/a&gt;んですが、僕の場合は 10 秒ぐらいしか考えずに、やりながら書いているので、ここを &lt;sup&gt;12&lt;/sup&gt;&amp;frasl;&lt;sub&gt;01&lt;/sub&gt; から読んでいる皆さんは僕がどんだけ毎回ドタバタしながら失敗しているかよくわかっていると思いますけど、まぁ、その今日もほとんど考えなしに走ります。&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&#34;とりあえずイジってみる&#34;&gt;とりあえずイジってみる&lt;/h3&gt;

&lt;p&gt;さて、あまり話題にしたことなかったんですが、今日は Eucalyptus の Web 管理画面の見た目を変更してみる話です。え～、Eucalyptus の Web 管理画面は /var/lib/eucalyptus/webapps/root.war というファイルにまとめられていて、/var/run/eucalyptus/webapp/ に展開されています。で、画面自体は GWT (Google Web Toolkit) で作られているようです。まぁ、僕がちゃんとしていたらここで颯爽と eclipse を立ち上げて華麗にイジり方などを解説するところですが、残念ながらちゃんとしていないので、そんな高等なことできません。&lt;/p&gt;

&lt;p&gt;じゃー今日のネタは何すんのさー？と思われたそこの旦那さま、何も難しいことありません、/var/lib/eucalyptus/webapp/root.war をイジイジして /etc/init.d/eucalyptus-cloud を restart するだけで、あら不思議、Web 管理画面の見た目が簡単に変わりましたよ的な結果が得られます。やっぱずぅ～っとインフラやってると、たまには陽の光があたる暖い場所へ出てみたくなりますよね？なりませんか？&lt;/p&gt;

&lt;p&gt;で、まず以下を実行して、元ファイルを展開します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# cd /var/lib/eucalyptus/webapp/
# mv root.war root.war.orig
# mkdir -p root
# cd root
# unzip ../root.war.orig
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、展開されたファイルを適宜変更します。例えば今回は themes/{active,eucalyptus}/ 配下にある logo.png と logo-small.png を変更し、global.css の background-color を #EEE から #fdec95 に変更しました。&lt;/p&gt;

&lt;p&gt;変更したら以下を実行します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# zip -r ../root.war ./
# /etc/init.d/eucalyptus-cloud restart
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、以下がビフォーアフターです。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ビフォー&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/20121213_0.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;アフター&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/20121213_2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;まぁ、今回は「ほら簡単に変更できるよ？」と言いたいだけなので、GWT を使わずに手で変更しましたが、もしちゃんと見た目をカスタマイズしたい場合は GWT を使わないとやってらんないと思います。(いや使うよね？)&lt;/p&gt;

&lt;p&gt;ちなみに今回は(いつも？)ご覧のとおり随分と手を抜いた内容なので、冒頭に延べた「10 分で考えて 5 分で書く」は守れないものの「10 秒程度しか考えられず 50 分ちょっとで書く」ことができました。え？どこに 50 分かかってるの？と思われるかもしれませんが、Web 管理画面の左上のロゴを作るのに 30 分ぐらいかかってます。(ぉぃ&lt;/p&gt;

&lt;p&gt;クリスマスまであと12日です ✌(՞ਊ ՞)✌&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>