<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Openstack on hablog</title>
    <link>http://blog.osamu.habuka.jp/tags/openstack/</link>
    <description>Recent content in Openstack on hablog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-jp</language>
    <lastBuildDate>Thu, 04 Dec 2014 08:08:08 +0900</lastBuildDate>
    <atom:link href="http://blog.osamu.habuka.jp/tags/openstack/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>OpenStack Advent Calendar 2014 4日目</title>
      <link>http://blog.osamu.habuka.jp/post/2014-12-03-openstack-advent-calendar-2014-4th/</link>
      <pubDate>Thu, 04 Dec 2014 08:08:08 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2014-12-03-openstack-advent-calendar-2014-4th/</guid>
      <description>

&lt;p&gt;これは &lt;a href=&#34;http://www.adventar.org/calendars/569&#34;&gt;OpenStack Advent Calendar 2014&lt;/a&gt; の4日目のエントリです。昨日は日本 Eucalyptus ユーザ会のエントリ &lt;a href=&#34;http://eucalyptus-users.jp/blog/2014/12/03/openstack-on-eucalyptus-slash-openstack-advent-calendar-2014-dot-12-dot-03/&#34;&gt;OpenStack on Eucalyptus&lt;/a&gt; でした。&lt;/p&gt;

&lt;p&gt;今日は題して「Eucalyptus ユーザが解説する Nova API 改造指南」です。例年ですと私の OpenStack ネタのエントリは失敗するのがお約束ですが、今日も無事失敗できるかどうかドキドキです。&lt;/p&gt;

&lt;p&gt;で、このエントリの目標は「API にパラメータを何か追加してみて、ちゃんとそれが処理されるか否か」という緩い目標設定となっております。(あまりマトモな目標設定をすると失敗する以前にまず何もできなかったりするので…」&lt;/p&gt;

&lt;h2 id=&#34;出力される項目を増やす&#34;&gt;出力される項目を増やす&lt;/h2&gt;

&lt;p&gt;まぁ、誰もがやってみる改造ですね。例えば nova list の出力にはそのインスタンスが「どの nova-compute で起動しているか？」なんて情報は含まれていません。知りたい場合は DB を覗かないと知れません(ホント？)、これはとても面倒臭い…ということで、nova list の結果にその情報が含まれるようにしちゃいましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ nova list
+--------------------------------------+------+--------+------------+-------------+------------------+
| ID                                   | Name | Status | Task State | Power State | Networks         |
+--------------------------------------+------+--------+------------+-------------+------------------+
| 98f7c56e-310f-4e57-9c9a-c0c5aa48cf08 | vm01 | ACTIVE | -          | Running     | private=10.0.0.2 |
+--------------------------------------+------+--------+------------+-------------+------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;まず、DB「nova」のテーブル「instances」を確認すると、以下のフィールドがあります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;+--------------------------+-----------------------+------+-----+---------+----------------+
| Field                    | Type                  | Null | Key | Default | Extra          |
+--------------------------+-----------------------+------+-----+---------+----------------+
| created_at               | datetime              | YES  |     | NULL    |                |
| updated_at               | datetime              | YES  |     | NULL    |                |
| deleted_at               | datetime              | YES  |     | NULL    |                |
| id                       | int(11)               | NO   | PRI | NULL    | auto_increment |
| internal_id              | int(11)               | YES  |     | NULL    |                |
| user_id                  | varchar(255)          | YES  |     | NULL    |                |
| project_id               | varchar(255)          | YES  | MUL | NULL    |                |
| image_ref                | varchar(255)          | YES  |     | NULL    |                |
| kernel_id                | varchar(255)          | YES  |     | NULL    |                |
| ramdisk_id               | varchar(255)          | YES  |     | NULL    |                |
| launch_index             | int(11)               | YES  |     | NULL    |                |
| key_name                 | varchar(255)          | YES  |     | NULL    |                |
| key_data                 | mediumtext            | YES  |     | NULL    |                |
| power_state              | int(11)               | YES  |     | NULL    |                |
| vm_state                 | varchar(255)          | YES  |     | NULL    |                |
| memory_mb                | int(11)               | YES  |     | NULL    |                |
| vcpus                    | int(11)               | YES  |     | NULL    |                |
| hostname                 | varchar(255)          | YES  |     | NULL    |                |
| host                     | varchar(255)          | YES  | MUL | NULL    |                |
| user_data                | mediumtext            | YES  |     | NULL    |                |
| reservation_id           | varchar(255)          | YES  | MUL | NULL    |                |
| scheduled_at             | datetime              | YES  |     | NULL    |                |
| launched_at              | datetime              | YES  |     | NULL    |                |
| terminated_at            | datetime              | YES  | MUL | NULL    |                |
| display_name             | varchar(255)          | YES  |     | NULL    |                |
| display_description      | varchar(255)          | YES  |     | NULL    |                |
| availability_zone        | varchar(255)          | YES  |     | NULL    |                |
| locked                   | tinyint(1)            | YES  |     | NULL    |                |
| os_type                  | varchar(255)          | YES  |     | NULL    |                |
| launched_on              | mediumtext            | YES  |     | NULL    |                |
| instance_type_id         | int(11)               | YES  |     | NULL    |                |
| vm_mode                  | varchar(255)          | YES  |     | NULL    |                |
| uuid                     | varchar(36)           | YES  | UNI | NULL    |                |
| architecture             | varchar(255)          | YES  |     | NULL    |                |
| root_device_name         | varchar(255)          | YES  |     | NULL    |                |
| access_ip_v4             | varchar(39)           | YES  |     | NULL    |                |
| access_ip_v6             | varchar(39)           | YES  |     | NULL    |                |
| config_drive             | varchar(255)          | YES  |     | NULL    |                |
| task_state               | varchar(255)          | YES  | MUL | NULL    |                |
| default_ephemeral_device | varchar(255)          | YES  |     | NULL    |                |
| default_swap_device      | varchar(255)          | YES  |     | NULL    |                |
| progress                 | int(11)               | YES  |     | NULL    |                |
| auto_disk_config         | tinyint(1)            | YES  |     | NULL    |                |
| shutdown_terminate       | tinyint(1)            | YES  |     | NULL    |                |
| disable_terminate        | tinyint(1)            | YES  |     | NULL    |                |
| root_gb                  | int(11)               | YES  |     | NULL    |                |
| ephemeral_gb             | int(11)               | YES  |     | NULL    |                |
| cell_name                | varchar(255)          | YES  |     | NULL    |                |
| node                     | varchar(255)          | YES  |     | NULL    |                |
| deleted                  | int(11)               | YES  |     | NULL    |                |
| locked_by                | enum(&#39;owner&#39;,&#39;admin&#39;) | YES  |     | NULL    |                |
| cleaned                  | int(11)               | YES  |     | NULL    |                |
| ephemeral_key_uuid       | varchar(36)           | YES  |     | NULL    |                |
+--------------------------+-----------------------+------+-----+---------+----------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、これらのフィールドのなかで、host と node がそれっぽいのですが、それらのどちらが nova-compute のホスト名なのかは、にわかユーザにはわからないので、どちらも表示させることにします。&lt;/p&gt;

&lt;p&gt;……&lt;/p&gt;

&lt;p&gt;えっと…まるで初心者のような──いや、僕は確かに初心者なので間違ってはいないのですが、不思議なことが起きました。何かと言うと、/opt/stack/nova が消えました。とりあえずコマンド履歴を途中から確認してみました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ubuntu@ubuntu:/opt/stack/nova$ vim nova/db/sqlalchemy/api.py
ubuntu@ubuntu:/opt/stack/nova$ vim nova/api/openstack/compute/servers.py
ubuntu@ubuntu:/opt/stack/nova$ vim nova/compute/api.py
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/py[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/py[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/py[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/se[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/serv[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/server[TAB]
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/servers.py
ubuntu@ubuntu:/opt/stack/nova$ vim /usr/local/lib/python2.7/dist-packages/novaclient/v1_1/servers.py
ubuntu@ubuntu:/opt/stack/nova$ vim nova/db/sqlalchemy/api.py
ubuntu@ubuntu:/opt/stack/nova$ vim nova/db/sqlalchemy/api.py
ubuntu@ubuntu:/opt/stack/nova$ pwd
/opt/stack/nova
ubuntu@ubuntu:/opt/stack/nova$ ls -al
total 0
ubuntu@ubuntu:/opt/stack/nova$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/vda1        16G  4.8G   11G  33% /
none            4.0K     0  4.0K   0% /sys/fs/cgroup
udev            2.0G  4.0K  2.0G   1% /dev
tmpfs           396M  432K  395M   1% /run
none            5.0M     0  5.0M   0% /run/lock
none            2.0G     0  2.0G   0% /run/shm
none            100M     0  100M   0% /run/user
ubuntu@ubuntu:/opt/stack/nova$ ls -al /opt/
total 12
drwxr-xr-x  3 root   root 4096 Dec  4 15:10 .
drwxr-xr-x 22 root   root 4096 Jul  6 11:45 ..
drwxr-xr-x 14 ubuntu root 4096 Dec  4 19:10 stack
ubuntu@ubuntu:/opt/stack/nova$ ls -al /opt/stack/
total 56
drwxr-xr-x 14 ubuntu root   4096 Dec  4 19:10 .
drwxr-xr-x  3 root   root   4096 Dec  4 15:10 ..
drwxr-xr-x 10 ubuntu ubuntu 4096 Dec  4 17:18 cinder
drwxr-xr-x  6 ubuntu root   4096 Dec  4 17:32 data
drwxr-xr-x  9 ubuntu ubuntu 4096 Dec  4 17:18 glance
drwxr-xr-x 12 ubuntu ubuntu 4096 Dec  4 17:23 heat
drwxr-xr-x  7 ubuntu ubuntu 4096 Dec  4 17:22 heat-cfntools
drwxr-xr-x 10 ubuntu ubuntu 4096 Dec  4 17:22 heat-templates
drwxr-xr-x 11 ubuntu ubuntu 4096 Dec  4 17:24 horizon
drwxr-xr-x 12 ubuntu ubuntu 4096 Dec  4 17:18 keystone
drwxr-xr-x  9 ubuntu ubuntu 4096 Dec  4 16:40 noVNC
drwxr-xr-x  5 ubuntu ubuntu 4096 Dec  4 16:16 requirements
drwxr-xr-x  3 ubuntu ubuntu 4096 Dec  4 17:23 status
drwxr-xr-x  8 ubuntu ubuntu 4096 Dec  4 17:32 tempest
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;いやぁ〜、いくら僕が OpenStack 初心者だからと言って、こんな現象に遭遇するとは…。一体どんな操作ミスをしたらこんなことになるんでしょう…不思議です。&lt;/p&gt;

&lt;p&gt;まぁ、でも消えちゃったものは仕方ないので、./unstack.sh 叩いてもう一度 ./stack.sh を叩くことにします。&lt;/p&gt;

&lt;p&gt;で、気をとりなおして再挑戦…と思って調査したんですが、&lt;a href=&#34;https://github.com/openstack/nova/blob/master/nova/api/openstack/compute/servers.py#L604-L610&#34;&gt;api/openstack/compute/servers.py のここ&lt;/a&gt; でインスタンスのリストを取得している風というのは分かるんですが、この結果を nova list 用に整形している &lt;a href=&#34;https://github.com/openstack/nova/blob/master/nova/api/openstack/compute/servers.py#L622&#34;&gt;この部分&lt;/a&gt; から先の&lt;a href=&#34;https://github.com/openstack/nova/blob/master/nova/api/openstack/compute/views/servers.py#L117-L120&#34;&gt;ここあたり&lt;/a&gt;で追うのに行き詰まりました。&lt;/p&gt;

&lt;p&gt;ここら辺が非 OpenStacker の限界ということでしょうか…orz&lt;/p&gt;

&lt;p&gt;ちなみに nova list ではなく、nova baremetal-node-list の出力項目を変更したい場合は &lt;a href=&#34;https://github.com/openstack/nova/blob/master/nova/api/openstack/compute/contrib/baremetal_nodes.py#L32-L33&#34;&gt;この node_fields の要素をイジって&lt;/a&gt;、更に novaclient の &lt;a href=&#34;https://github.com/openstack/python-novaclient/blob/master/novaclient/v1_1/contrib/baremetal.py#L247-L259&#34;&gt;v1_1/contrib/baremetal.py の _print_baremetal_nodes_list のここ&lt;/a&gt;をイジれば変更できます…が、たぶんそんなこと OpenStacker の皆さんなら周知の事実ですよね…すみません…orz&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;そのあと元木さんから「それ、改造しなくても admin なら &amp;ndash;fields オプションで OS-EXT-SRV-ATTR: で引けるよ？」と教えてもらいましたwwww (同じく真壁さんからもw)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ nova list --all-tenants --fields name,networks,OS-EXT-SRV-ATTR:host,OS-EXT-SRV-ATTR:node
+--------------------------------------+------+------------------+-----------------------+-----------------------+
| ID                                   | Name | Networks         | OS-EXT-SRV-ATTR: Host | OS-EXT-SRV-ATTR: Node |
+--------------------------------------+------+------------------+-----------------------+-----------------------+
| 9bc0c1fb-d55c-481f-84fb-fadd21ec1d35 | vm01 | private=10.0.0.2 | ubuntu                |                       |
+--------------------------------------+------+------------------+-----------------------+-----------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;novaclient-のサブコマンドに引数を持たないオプションを追加する方法&#34;&gt;novaclient のサブコマンドに引数を持たないオプションを追加する方法&lt;/h2&gt;

&lt;p&gt;例えば、nova baremetal-node-delete のオプションに引数を持たない &amp;ndash;force というオプションを追加したい場合は &lt;a href=&#34;https://github.com/openstack/python-novaclient/blob/master/novaclient/v1_1/contrib/baremetal.py&#34;&gt;v1_1/contrib/baremetal.py&lt;/a&gt; の以下を&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;@utils.arg(
    &#39;node&#39;,
    metavar=&#39;&amp;lt;node&amp;gt;&#39;,
    help=_(&#39;ID of the node to delete.&#39;))
def do_baremetal_node_delete(cs, args):
    &amp;quot;&amp;quot;&amp;quot;Remove a baremetal node and any associated interfaces.&amp;quot;&amp;quot;&amp;quot;
    node = _find_baremetal_node(cs, args.node)
    cs.baremetal.delete(node)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以下のように変更するだけです。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;@utils.arg(
    &#39;node&#39;,
    metavar=&#39;&amp;lt;node&amp;gt;&#39;,
    help=_(&#39;ID of the node to delete.&#39;))
@utils.arg(&#39;--force&#39;,
    action=&amp;quot;store_true&amp;quot;,
    default=False,
    help=&#39;force delete baremetal machine.&#39;)
def do_baremetal_node_delete(cs, args):
    &amp;quot;&amp;quot;&amp;quot;Remove a baremetal node and any associated interfaces.&amp;quot;&amp;quot;&amp;quot;
    node = _find_baremetal_node(cs, args.node)
    cs.baremetal.delete(node)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あとは do_baremetal_node_delete の中でオプションの値を参照する場合は args.force を見れば OK です。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;明日の &lt;a href=&#34;http://www.adventar.org/calendars/569&#34;&gt;OpenStack Advent Calendar 2014 5日目&lt;/a&gt; は Shogos3 さんのエントリです。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>OpenStack Advent Calendar 2013 JP 8日目</title>
      <link>http://blog.osamu.habuka.jp/post/2013-12-08.AdventCalendar-day-8/</link>
      <pubDate>Sun, 08 Dec 2013 01:11:57 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2013-12-08.AdventCalendar-day-8/</guid>
      <description>

&lt;h1 id=&#34;碧川涼&#34;&gt;碧川涼&lt;/h1&gt;

&lt;p&gt;さて、今日も名前に緑色のつく人を見つけられませんでした。が、よくよく考えたら「碧」っていう字も、青だったり緑だったりするじゃないですか、ってことで、今日はゲーム『NOëL 〜La neige〜』に登場するキャラクターの「&lt;a href=&#34;http://ja.wikipedia.org/wiki/NOeL#NO.C3.ABL_.E3.80.9CLa_neige.E3.80.9C_.2F_NO.C3.ABL_.E3.80.9CLa_neige.E3.80.9C_Special&#34;&gt;碧川涼&lt;/a&gt;」さんの誕生日だそうです。お誕生日おめでとうございます。えーと、恋愛シミュレーションゲームだそうです。すみません、残念ながらやったことないので、存じあげておりませんでした。&lt;/p&gt;

&lt;p&gt;それと、この碧川涼というキャラクターの声を演じているのは&lt;a href=&#34;http://ja.wikipedia.org/wiki/%E6%A0%B9%E8%B0%B7%E7%BE%8E%E6%99%BA%E5%AD%90&#34;&gt;根谷美智子&lt;/a&gt;さんなんですが、根谷さんの親友の&lt;a href=&#34;http://ja.wikipedia.org/wiki/%E8%8F%85%E5%8E%9F%E7%A5%A5%E5%AD%90&#34;&gt;菅原祥子&lt;/a&gt;さんは12月12日が誕生日だそうです。おめでとうございます。&lt;/p&gt;

&lt;h1 id=&#34;glance-のかわりに-walrus-を使ってみる&#34;&gt;Glance のかわりに Walrus を使ってみる&lt;/h1&gt;

&lt;p&gt;まず最初に、&lt;a href=&#34;https://twitter.com/ishikawa84g&#34;&gt;我らが愛する石川&lt;/a&gt; さんがこんなことをツブやいてまして&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; data-lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;OpenStack Advent Calendar 2013、誰も記事内で AdventCalendarの何日目という宣言をしてないの良くない。&lt;/p&gt;&amp;mdash; 石川@驚きの白々しさ (@ishikawa84g) &lt;a href=&#34;https://twitter.com/ishikawa84g/status/408833430890115072&#34;&gt;2013年12月6日&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;これは、やばい、このままだと enforcing されちゃう…(((( ；ﾟДﾟ)))…ってことで、今日は OpenStack Advent Calendar 2013 JP の 8 日目です。&lt;/p&gt;

&lt;p&gt;ところで、&lt;a href=&#34;http://036.habuka.jp/diary/?date=20121203#p04&#34;&gt;去年の OpenStack Advent Calendar 2012 JP の僕のエントリー&lt;/a&gt;は惨々な結果でした…。今年は反省しちゃんとやりきりたいと思いますが、どうやら僕は OpenStack 界隈では「負け犬」「噛ませ犬」のポジションらしく「今年も&lt;font size=&#34;5&#34;&gt;惨々な内容&lt;/font&gt;でひとつよろしく頼むよキミぃ」とか言われてます…(｡´Д⊂)&lt;/p&gt;

&lt;h2 id=&#34;openstack-環境の設定&#34;&gt;OpenStack 環境の設定&lt;/h2&gt;

&lt;p&gt;えー、僕は OpenStack 初心者&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:1&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;なので、いま流行りの &lt;a href=&#34;http://openstack.redhat.com/Quickstart&#34;&gt;RDO? Packstack?&lt;/a&gt; を使って構築しました。まぁ、Packstack を用いた構築方法についてはきっと誰かが今回の Advent Calendar で書いてくれるでしょうから、ここでは割愛します。&lt;/p&gt;

&lt;p&gt;ちなみに、ここで使う Walrus は先日の &lt;a href=&#34;http://www.adventar.org/calendars/202&#34;&gt;Eucalyptus Advent Calendar 2013&lt;/a&gt; のエントリ「&lt;a href=&#34;http://036.habuka.jp/diary/?date=20131202&#34;&gt;Walrus をだけを使ってみる&lt;/a&gt;」で作った環境を使います。&lt;/p&gt;

&lt;p&gt;まず、glance のサービスを止めます。だって使わないんだもんだもん。止めちゃいますよー。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@rdo ~(keystone_admin)]# /etc/init.d/openstack-glance-api stop
Stopping openstack-glance-api:                             [  OK  ]
[root@rdo ~(keystone_admin)]# /etc/init.d/openstack-glance-registry stop
Stopping openstack-glance-registry:                        [  OK  ]
[root@rdo ~(keystone_admin)]# /etc/init.d/openstack-glance-scrubber stop
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、nova が glance じゃなくて Walrus を使うように設定します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@rdo ~(keystone_admin)]# diff -u /etc/nova/nova.conf.glance /etc/nova/nova.conf
--- /etc/nova/nova.conf.glance  2013-12-03 14:46:31.314000061 +0900
+++ /etc/nova/nova.conf 2013-12-03 17:29:31.213000032 +0900
@@ -939,7 +939,7 @@
 # with https:// for ssl-based glance api servers.
 # ([hostname|ip]:port) (list value)
 #glance_api_servers=$glance_host:$glance_port
-glance_api_servers=192.168.32.74:9292
+#glance_api_servers=192.168.32.74:9292

 # Allow to perform insecure SSL (https) requests to glance
 # (boolean value)
@@ -965,16 +965,16 @@

 # hostname or ip for OpenStack to use when accessing the s3
 # api (string value)
-#s3_host=$my_ip
+s3_host=192.168.32.73

 # port used when accessing the s3 api (integer value)
-#s3_port=3333
+s3_port=8773

 # access key to use for s3 server for images (string value)
-#s3_access_key=notchecked
+s3_access_key=AKIAMNYEAUG5ZJBN9KPH

 # secret key to use for s3 server for images (string value)
-#s3_secret_key=notchecked
+s3_secret_key=WlsMz8d6LdZKOmSQo07LmtujRqN6OVKw4NoKe02V

 # whether to use ssl when talking to s3 (boolean value)
 #s3_use_ssl=false
@@ -2595,7 +2595,7 @@
 qpid_reconnect=True
 sql_connection=mysql://nova:db56f39a7e064ccc@192.168.32.74/nova
 qpid_reconnect_timeout=0
-image_service=nova.image.glance.GlanceImageService
+image_service=nova.image.s3.S3ImageService
 logdir=/var/log/nova
 qpid_reconnect_interval_max=0
 qpid_reconnect_limit=0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;えーと、ここまで設定して、ふと気付いたんですよ。Walrus のエンドポイントって http://ホスト:8773/services/Walrus っていう形式なんすよねー。えぇ、その値を設定するパラメータって s3_host と s3_port じゃ書ききれないよねぇ…。&lt;/p&gt;

&lt;p&gt;で、nova/image/s3.py を書き換えようと思ったんですが、@ishikawa84g さんと @shida1234 さんが「それ、keystone に登録しちゃえばいいんじゃない？」と助け船を出してくれまして、以下のように登録してみました。あ、もちろん keystone service-delete で glance のサービスとエンドポイント情報を削除してから実施してます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@rdo ~(keystone_admin)]# keystone service-create --name walrus --type image --description &amp;quot;Eucalyptus Image Service&amp;quot;
+-------------+----------------------------------+
|   Property  |              Value               |
+-------------+----------------------------------+
| description |     Eucalyptus Image Service     |
|      id     | af7ba823c7ab4f58917af6a0fad81006 |
|     name    |              walrus              |
|     type    |              image               |
+-------------+----------------------------------+

[root@rdo ~(keystone_admin)]# keystone endpoint-create --service af7ba823c7ab4f58917af6a0fad81006 --publicurl http://192.168.32.73:8773/services/Walrus --adminurl http://192.168.32.73:8773/services/Walrus --internalurl http://192.168.32.73:8773/services/Walrus
+-------------+-------------------------------------------+
|   Property  |                   Value                   |
+-------------+-------------------------------------------+
|   adminurl  | http://192.168.32.73:8773/services/Walrus |
|      id     |      fa3de0db20ae4903a429c35beabeed37     |
| internalurl | http://192.168.32.73:8773/services/Walrus |
|  publicurl  | http://192.168.32.73:8773/services/Walrus |
|    region   |                 regionOne                 |
|  service_id |      af7ba823c7ab4f58917af6a0fad81006     |
+-------------+-------------------------------------------+
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あ、一応 glance っていうか、Image Store とおしゃべりするであろう nova-api と nova-compute は再起動させます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@rdo ~(keystone_admin)]# /etc/init.d/openstack-nova-api restart
Stopping openstack-nova-api:                               [  OK  ]
Starting openstack-nova-api:                               [  OK  ]
[root@rdo ~(keystone_admin)]# /etc/init.d/openstack-nova-compute restart
Stopping openstack-nova-compute:                           [  OK  ]
Starting openstack-nova-compute:                           [  OK  ]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、ちゃんと接続できるかなーっと nova image-list (カチャカチャカチャ…ッターン！)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@rdo ~(keystone_admin)]# nova image-list
ERROR: The server has either erred or is incapable of performing the requested operation. (HTTP 500) (Request-ID: req-ca8b1ed6-7ff0-4863-a05e-f88598a31469)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あ、あれー？何だろう？と思って nova-api のログを見ると…&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/nova/api/openstack/compute/images.py&amp;quot;, line 203, in detail
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack     **page_params)
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/nova/image/glance.py&amp;quot;, line 264, in detail
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack     for image in images:
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/glanceclient/v1/images.py&amp;quot;, line 174, in paginate
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack     images = self._list(url, &amp;quot;images&amp;quot;)
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/glanceclient/common/base.py&amp;quot;, line 53, in _list
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack     resp, body = self.api.json_request(&#39;GET&#39;, url)
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/glanceclient/common/http.py&amp;quot;, line 266, in json_request
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack     resp, body_iter = self._http_request(url, method, **kwargs)
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/glanceclient/common/http.py&amp;quot;, line 235, in _http_request
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack     raise exc.CommunicationError(message=message)
2013-12-03 18:30:05.838 25016 TRACE nova.api.openstack CommunicationError: Error communicating with http://192.168.32.74:9292 [Errno 111] ECONNREFUSED
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あらやだ、この子、Glance 見に行ってんじゃないの…。っていうか、何で nova/image/glance.py が呼ばれてるのさ…。ということでコード nova/api/openstack/compute/images.py を確認すると…&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import nova.image.glance
from nova.openstack.common.gettextutils import _
import nova.utils
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あぁ…、思いっきり import nova.image.glance してるじゃん…、じゃぁ誰が「image_service=nova.image.s3.S3ImageService」の設定を見てくれるの？&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@rdo ~(keystone_admin)]# grep -i CONF.image_service -r /usr/lib/python2.6/site-packages/nova/
[root@rdo ~(keystone_admin)]# grep &amp;quot;&#39;image_service&#39;&amp;quot; -r /usr/lib/python2.6/site-packages/nova/
[root@rdo ~(keystone_admin)]#
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ちょっと待て、本来なら今頃、OpenStack から Walrus を使ってインスタンスを起動して&lt;font size=&#34;5&#34;&gt;感無量～人´ω｀*)&lt;/font&gt;とかやってるはずなのに、何？あれ？誰も nova.conf の image_service を見てないんじゃないの？ちょっと！どーゆーこと？何この&lt;font size=&#34;5&#34;&gt;無力感…(:.;´;Д;ﾟ;.:)&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;Advent Calendar のエントリに「Glance のかわりに Walrus を使う(キリッ」とか書いたのに、このままではまた去年と同様に&lt;font size=&#34;5&#34;&gt;「m9(^Д^)プギャー」&lt;/font&gt;ですよ。もうね、どんだけ僕は成功しちゃいけない星のもとに生まれたんすか？&lt;/p&gt;

&lt;p&gt;ってことで、足掻いてみます。そりゃーもう必死に足掻いてみます。アラフォー男児が本気で足掻いたら、きっと nova だって「おっぉ、わかったぉ、Glance やめて S3 喋ってみるよ」って折れてくれるはず、nova 懐深い子、きっと僕も包んでくれるはず。&lt;/p&gt;

&lt;p&gt;まず、手始めに nova/image/glance.py を呼び出している nova/api/openstack/compute/images.py を見てみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class Controller(wsgi.Controller):
    &amp;quot;&amp;quot;&amp;quot;Base controller for retrieving/displaying images.&amp;quot;&amp;quot;&amp;quot;

    _view_builder_class = views_images.ViewBuilder

    def __init__(self, image_service=None, **kwargs):
        &amp;quot;&amp;quot;&amp;quot;Initialize new `ImageController`.

        :param image_service: `nova.image.glance:GlanceImageService`

        &amp;quot;&amp;quot;&amp;quot;
        super(Controller, self).__init__(**kwargs)
        self._image_service = (image_service or
                               nova.image.glance.get_default_image_service())
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;うん、あら？、ほう、image_service image_service が None じゃなければ glance.get_default_image_service は呼ばれないのか。そうかそうか、んじゃー、glance.py に get_default_image_service があるってことは、s3.py にもあるのかな？&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@rdo ~]# grep &amp;quot;def get_default_image_service&amp;quot; -r /usr/lib/python2.6/site-packages/nova/image/s3.py | wc -l
0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;うん、無いね、全く無いね、容赦なく無いね。&lt;/p&gt;

&lt;p&gt;よし、おいちゃん覚悟した、Pythonian じゃないうえに Python 書けないけど、頑張る。nova/api/openstack/compute/images.py を書き換えるよ。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;--- /usr/lib/python2.6/site-packages/nova/api/openstack/compute/images.py.orig  2013-12-07 05:19:23.774000083 +0900
+++ /usr/lib/python2.6/site-packages/nova/api/openstack/compute/images.py       2013-12-07 05:14:58.438000084 +0900
@@ -21,6 +21,7 @@
 from nova.api.openstack import xmlutil
 from nova import exception
 import nova.image.glance
+import nova.image.s3
 from nova.openstack.common.gettextutils import _
 import nova.utils

@@ -96,6 +97,7 @@

         &amp;quot;&amp;quot;&amp;quot;
         super(Controller, self).__init__(**kwargs)
+        image_service = nova.image.s3.S3ImageService()
         self._image_service = (image_service or
                                nova.image.glance.get_default_image_service())

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、nova-api を再起動して、nova image-list (カチャカチャカチャ…ッターン！)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/nova/api/openstack/compute/images.py&amp;quot;, line 205, in detail
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack     **page_params)
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/nova/image/s3.py&amp;quot;, line 168, in detail
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack     images = self.service.detail(context, **kwargs)
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/nova/image/glance.py&amp;quot;, line 264, in detail
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack     for image in images:
(中略)
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack   File &amp;quot;/usr/lib/python2.6/site-packages/glanceclient/common/http.py&amp;quot;, line 235, in _http_request
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack     raise exc.CommunicationError(message=message)
2013-12-07 05:15:24.699 10379 TRACE nova.api.openstack CommunicationError: Error communicating with http://192.168.32.74:9292 [Errno 111] ECONNREFUSED
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ば、馬鹿な…。glance を叩きに行ってるだと？&lt;/p&gt;

&lt;p&gt;詳しく追うの面倒なので、ざっと確認すると、S3ImageService.detail -&amp;gt; self.service.detail で、んじゃー self.service は何かしら？って言うと、S3ImageService の __init__ で以下の定義がありまして&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    def __init__(self, service=None, *args, **kwargs):
        self.cert_rpcapi = nova.cert.rpcapi.CertAPI()
        self.service = service or glance.get_default_image_service()
        self.service.__init__(*args, **kwargs)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;service が None のときは glance.get_default_image_service() を呼ぶから、結果 self.service には GlanceImageService が入るというわけでして、&lt;/p&gt;

&lt;p&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
&lt;font size=&#34;5&#34;&gt;(＃ﾟДﾟ)&lt;/font&gt;
&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;/p&gt;

&lt;p&gt;いやもう駄目じゃん、これ、何があっても glance 呼ばれるじゃん。だって service = S3ImageService やっても循環するだけでしょ？いやいやいや、やってみたよ、無駄だとわかってもやってみたよ、修造よろしくリスペクトな気持ちでやってみたよ、そしたらね、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2013-12-06 16:39:41.592 12145 DEBUG nova.wsgi [-] Loading app ec2 from /etc/nova/api-paste.ini load_app /usr/lib/python2.6/site-packages/nova/wsgi.py:
484
2013-12-06 16:39:41.680 12145 DEBUG nova.image.s3 [-] s3.py serivce is None __init__ /usr/lib/python2.6/site-packages/nova/image/s3.py:91
2013-12-06 16:39:41.681 12145 DEBUG nova.image.s3 [-] s3.py serivce is None __init__ /usr/lib/python2.6/site-packages/nova/image/s3.py:91
(中略)
2013-12-06 16:39:41.728 12145 DEBUG nova.image.s3 [-] s3.py serivce is None __init__ /usr/lib/python2.6/site-packages/nova/image/s3.py:91
2013-12-06 16:39:41.728 12145 DEBUG nova.image.s3 [-] s3.py serivce is None __init__ /usr/lib/python2.6/site-packages/nova/image/s3.py:91
2013-12-06 16:39:41.729 12145 CRITICAL nova [-] &#39;module&#39; object has no attribute &#39;tracebacklimit&#39;
2013-12-06 16:39:41.729 12145 TRACE nova Traceback (most recent call last):
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/bin/nova-api&amp;quot;, line 10, in &amp;lt;module&amp;gt;
2013-12-06 16:39:41.729 12145 TRACE nova     sys.exit(main())
(中略)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib/python2.6/site-packages/nova/api/ec2/cloud.py&amp;quot;, line 226, in __init__
2013-12-06 16:39:41.729 12145 TRACE nova     self.image_service = s3.S3ImageService()
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib/python2.6/site-packages/nova/image/s3.py&amp;quot;, line 93, in __init__
2013-12-06 16:39:41.729 12145 TRACE nova     self.service = S3ImageService()
(中略)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib/python2.6/site-packages/nova/image/s3.py&amp;quot;, line 91, in __init__
2013-12-06 16:39:41.729 12145 TRACE nova     LOG.debug(&amp;quot;s3.py serivce is %s&amp;quot;, service)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 1305, in debug
2013-12-06 16:39:41.729 12145 TRACE nova     self.logger.debug(msg, *args, **kwargs)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 1044, in debug
2013-12-06 16:39:41.729 12145 TRACE nova     self._log(DEBUG, msg, args, **kwargs)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 1173, in _log
2013-12-06 16:39:41.729 12145 TRACE nova     self.handle(record)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 1183, in handle
2013-12-06 16:39:41.729 12145 TRACE nova     self.callHandlers(record)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 1220, in callHandlers
2013-12-06 16:39:41.729 12145 TRACE nova     hdlr.handle(record)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 679, in handle
2013-12-06 16:39:41.729 12145 TRACE nova     self.emit(record)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/handlers.py&amp;quot;, line 405, in emit
2013-12-06 16:39:41.729 12145 TRACE nova     logging.FileHandler.emit(self, record)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 860, in emit
2013-12-06 16:39:41.729 12145 TRACE nova     StreamHandler.emit(self, record)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 804, in emit
2013-12-06 16:39:41.729 12145 TRACE nova     self.handleError(record)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/logging/__init__.py&amp;quot;, line 733, in handleError
2013-12-06 16:39:41.729 12145 TRACE nova     traceback.print_exception(ei[0], ei[1], ei[2], None, sys.stderr)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/traceback.py&amp;quot;, line 125, in print_exception
2013-12-06 16:39:41.729 12145 TRACE nova     print_tb(tb, limit, file)
2013-12-06 16:39:41.729 12145 TRACE nova   File &amp;quot;/usr/lib64/python2.6/traceback.py&amp;quot;, line 57, in print_tb
2013-12-06 16:39:41.729 12145 TRACE nova     if hasattr(sys, &#39;tracebacklimit&#39;):
2013-12-06 16:39:41.729 12145 TRACE nova AttributeError: &#39;module&#39; object has no attribute &#39;tracebacklimit&#39;
2013-12-06 16:39:41.729 12145 TRACE nova
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;tracebacklimit …そりゃそうだ、だってループしてんだもん、そりゃそうだ。&lt;/p&gt;

&lt;p&gt;あーあ、終りましたよ、また今年も失敗で終りですよ。何だよ、タイトルを「Glance のかわりに Walrus を使ってみる」じゃなくて「Glance のバックエンドに Walrus を使ってみる」って書いてたら今頃きっと成功ですよ。もうね、世の OpenStacker が「ぐぐー、やっぱ Glance より Walrus かー、ちきしょー」っていう姿を夢見て走ってみたのに、気付いたら明後日の方向にスロットル全開ですよ。&lt;/p&gt;

&lt;p&gt;ちっきしょー、s3.py なんて名前でファイルを置いとくから淡い期待を抱いちゃうじゃん、もうね、s3.py じゃなくて ese3.py とかで置いておいてくれたらいいのに。&lt;/p&gt;

&lt;p&gt;&lt;br/&gt;&lt;br/&gt;&lt;font size=&#34;5&#34; color=&#34;#ee2222&#34;&gt;クリスマスまであと17日です✌(́◓q◔`)✌&lt;/font&gt;&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;ツールに頼らないと環境を作れないぐらいに初心者です
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:1&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Eucalyptus Advent Calendar 2012 JP 三日目</title>
      <link>http://blog.osamu.habuka.jp/post/2012-12-03.eucalyptus-adventcalendar-2012-jp-day-3/</link>
      <pubDate>Mon, 03 Dec 2012 01:16:23 +0900</pubDate>
      
      <guid>http://blog.osamu.habuka.jp/post/2012-12-03.eucalyptus-adventcalendar-2012-jp-day-3/</guid>
      <description>

&lt;h1 id=&#34;euca-monkey-を使ってみたよ&#34;&gt;Euca Monkey を使ってみたよ？&lt;/h1&gt;

&lt;p&gt;さて、Eucalyptus Advent Calendar 2012 JP の三日目です。初日がどうやら一部で「うわっ飛ばしすぎじゃね？」とか心配されたようなので、3日目は大人し目にいきたいと思います。&lt;/p&gt;

&lt;p&gt;で、「大人し目って何だ？」って考えてみたんですが、大人しい == ドタバタしない系だと思い、つまり何か仕掛けたら放置プレイでいいんじゃね？となるようなものをターゲットにしようってことになり、協議の結果 &lt;a href=&#34;https://github.com/eucalyptus/euca-monkey&#34;&gt;Euca Monkey&lt;/a&gt; を扱おうという結論に達しました。で、この Euca Monkey ってのは Eucalyptus のストレステストツールでして、README とかを読んでると &lt;a href=&#34;https://github.com/eucalyptus/eutester&#34;&gt;Eutester&lt;/a&gt; っていうテストフレームワークを使うそうです。でもここでいきなりこのテストフレームワークの使い方を説明しだすと、また皆さんを置いてけぼりな展開になるので、ここはぐっと我慢して Euca Monkey を使う方法に徹します。&lt;/p&gt;

&lt;p&gt;ちなみに Euca Monkey の作者は Eucalyptus 社のソフトウェアデザイナ の Kyo Lee さんで、詳しくは&lt;a href=&#34;http://eucatest.wordpress.com/2012/11/07/10-steps-to-euca-monkey/&#34;&gt;彼のブログ&lt;/a&gt;で紹介されています。&lt;/p&gt;

&lt;h1 id=&#34;環境の準備&#34;&gt;環境の準備&lt;/h1&gt;

&lt;p&gt;で、何はともあれ Eucalyptus の環境を作らないと話ははじまらないんですが、&lt;a href=&#34;http://036.habuka.jp/?date=20121201&#34;&gt;初日のときみたい&lt;/a&gt;に nightly build に手をだして本筋から外れるのも何なので、今回は日和って Eucalyptus 3.1 の環境でやります。ステーブルサイコー！&lt;/p&gt;

&lt;p&gt;ちなみに Eucalyptus 3.1 の環境の作り方は OSPN Press の&lt;a href=&#34;http://www.ospn.jp/press/20121108no29-1-useit-oss.html&#34;&gt;「オープンソース」を使ってみよう (第26回 dodai-deploy編)&lt;/a&gt;を参考にしてください。&lt;/p&gt;

&lt;p&gt;あぁ、一応聖なる紳士淑女のために説明をしますが、ちゃんとメモリを 16GB も積んだマシン2台構成で1台はフロントエンド (CLC/CC) で、もう1台はノードとしました。で、CLC/CC の eucalyptus.conf は以下のように変更しています。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# diff -u eucalyptus.conf.orig eucalyptus.conf
--- eucalyptus.conf.orig        2012-09-27 08:17:29.000000000 +0900
+++ eucalyptus.conf     2012-12-03 02:12:05.000000000 +0900
@@ -154,13 +154,13 @@
 # The networking mode in which to run.  The same mode must be specified
 # on all CCs and NCs in the entire cloud.  Valid values include SYSTEM,
 # STATIC, MANAGED, and MANAGED-NOVLAN.
-VNET_MODE=&amp;quot;SYSTEM&amp;quot;
+VNET_MODE=&amp;quot;MANAGED&amp;quot;

 # The name of the network interface that is on the same network as
 # the NCs.  In Managed and Managed (No VLAN) modes this may need to be
 # a bridge.  The default is &amp;quot;eth0&amp;quot;.
 # Networking modes: Static, Managed, Managed (No VLAN)
-VNET_PRIVINTERFACE=&amp;quot;eth0&amp;quot;
+VNET_PRIVINTERFACE=&amp;quot;eth1&amp;quot;

 # On a CC, this is the name of the network interface that is connected
 # to the &amp;quot;public&amp;quot; network.  The default is &amp;quot;eth0&amp;quot;.
@@ -188,22 +188,22 @@
 # A space-separated list of individual and/or hyphenated ranges of public
 # IP addresses to assign to instances.
 # Networking modes: Managed, Managed (No VLAN)
-#VNET_PUBLICIPS=&amp;quot;your-free-public-ip-1 your-free-public-ip-2 ...&amp;quot;
+VNET_PUBLICIPS=&amp;quot;192.168.33.110-192.168.33.250&amp;quot;

 # The address and network mask of the network the cloud should use for
 # instances&#39; private IP addresses.
 # Networking modes: Static, Managed, Managed (No VLAN)
-#VNET_SUBNET=&amp;quot;192.168.0.0&amp;quot;
-#VNET_NETMASK=&amp;quot;255.255.0.0&amp;quot;
+VNET_SUBNET=&amp;quot;10.0.0.0&amp;quot;
+VNET_NETMASK=&amp;quot;255.0.0.0&amp;quot;

 # The number of IP addresses to allocate to each security group.
 # Specify a power of 2 between 16 and 2048.
 # Networking modes: Managed, Managed (No VLAN)
-#VNET_ADDRSPERNET=&amp;quot;32&amp;quot;
+VNET_ADDRSPERNET=&amp;quot;2048&amp;quot;

 # The address of the DNS server to supply to instances in DHCP responses.
 # Networking modes: Static, Managed, Managed (No VLAN)
-#VNET_DNS=&amp;quot;your-dns-server-ip&amp;quot;
+VNET_DNS=&amp;quot;192.168.32.21&amp;quot;

 # The network broadcast address and default gateway to supply to instances
 # in DHCP responses.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、NC の eucalyptus.conf は以下のように変更しました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# diff -u eucalyptus.conf.orig eucalyptus.conf
--- eucalyptus.conf.orig        2012-09-27 08:17:29.000000000 +0900
+++ eucalyptus.conf     2012-12-03 02:12:24.000000000 +0900
@@ -88,10 +88,10 @@
 # KVM hypervisor.

 # If &amp;quot;1&amp;quot;, use Virtio for the root file system
-USE_VIRTIO_ROOT=&amp;quot;0&amp;quot;
+USE_VIRTIO_ROOT=&amp;quot;1&amp;quot;

 # If &amp;quot;1&amp;quot;, use Virtio for dynamic block volumes
-USE_VIRTIO_DISK=&amp;quot;0&amp;quot;
+USE_VIRTIO_DISK=&amp;quot;1&amp;quot;

 # If &amp;quot;1&amp;quot;, use Virtio for the network card
 USE_VIRTIO_NET=&amp;quot;0&amp;quot;
@@ -154,7 +154,7 @@
 # The networking mode in which to run.  The same mode must be specified
 # on all CCs and NCs in the entire cloud.  Valid values include SYSTEM,
 # STATIC, MANAGED, and MANAGED-NOVLAN.
-VNET_MODE=&amp;quot;SYSTEM&amp;quot;
+VNET_MODE=&amp;quot;MANAGED&amp;quot;

 # The name of the network interface that is on the same network as
 # the NCs.  In Managed and Managed (No VLAN) modes this may need to be
@@ -171,13 +171,13 @@
 # configuration, this may be a bridge or a physical interface that is
 # attached to the bridge.  The default is &amp;quot;eth0&amp;quot;.
 # Networking modes: Managed
-VNET_PUBINTERFACE=&amp;quot;eth0&amp;quot;
+VNET_PUBINTERFACE=&amp;quot;eth1&amp;quot;

 # On an NC, this is the name of the bridge interface to which instances&#39;
 # network interfaces should attach.  A physical interface that can reach
 # the CC must be attached to this bridge.
 # Networking modes: System, Static, Managed (No VLAN)
-VNET_BRIDGE=&amp;quot;br0&amp;quot;
+VNET_BRIDGE=&amp;quot;br1&amp;quot;

 # A map of MAC addresses to IP addresses that Eucalyptus should allocate
 # to instances when running in Static mode.  Separate MAC addresses and
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;マシンイメージの準備&#34;&gt;マシンイメージの準備&lt;/h2&gt;

&lt;p&gt;Euca Monkey を動かすには何故か CentOS 6.3 の環境が必要だそうです。ちなみに物理でも仮想でもいいようなので、インスタンス上でやろうと思うんですが、マシンイメージを用意するのがメンドーだなーっていうあなたのために&lt;/p&gt;

&lt;p&gt;&lt;font size=&#34;5&#34;&gt;「ハイ、&lt;a href=&#34;http://emis.eucalyptus.com/&#34;&gt;http://emis.eucalyptus.com/&lt;/a&gt; 」。&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;え？そこはマシンイメージ工房じゃないの？って思われるかもしれませんが、残念ながら CentOS 6.3 のイメージは用意してませんので、Eucalyptus 社が配布しているイメージを使います。&lt;/p&gt;

&lt;p&gt;で、マシンイメージの取得は、&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;eustore-describe-images コマンドで一覧を取得し&lt;/li&gt;
&lt;li&gt;eustore-install-image コマンドでインストールする&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;という簡単なコマンドと手順で実現できるため、まずは eustore-describe-images コマンドを叩きます。(カチャカチャカチャ…ッターン！)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# eustore-describe-images
Traceback (most recent call last):
  File &amp;quot;/usr/bin/eustore-describe-images&amp;quot;, line 36, in &amp;lt;module&amp;gt;
    import euca2ools.commands.eustore.describeimages
ImportError: No module named eustore.describeimages
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;さぁ、はじまりました。これだから使い慣れないディストリビューションで Eucalyptus 動かすの嫌なんだよなー。(完全に責任転嫁)&lt;/p&gt;

&lt;p&gt;でとりあえず euca2ools のバージョンを確認です。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# dpkg -l | grep euca2ools
ii  euca2ools                             2.0.0~bzr516-0ubuntu3          managing cloud instances for Eucalyptus
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あー、これは無理だわー、eustore-describe-images コマンドは euca2ools 2.1 からだわー。しょーがないから便利コマンドは諦めて &lt;a href=&#34;http://emis.eucalyptus.com/starter-emis/euca-centos6.3-2012.11.07-x86_64.tgz&#34;&gt;CentOS 6.3 のイメージファイル&lt;/a&gt;を直接取得して手動で登録します。&lt;/p&gt;

&lt;p&gt;で、取得したら以下の&lt;strong&gt;ように&lt;/strong&gt;登録します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# tar -xzf euca-centos6.3-2012.11.07-x86_64.tgz
# cd centos-6.3-x86_64/
# euca-bundle-image --kernel true -i kvm-kernel/vmlinuz-2.6.32-279.14.1.el6.x86_64
# euca-upload-bundle -b kernel.001 -m /tmp/vmlinuz-2.6.32-279.14.1.el6.x86_64.manifest.xml
# euca-register -a x86_64 kernel.001/vmlinuz-2.6.32-279.14.1.el6.x86_64.manifest.xml
IMAGE   eki-945F390D

# euca-bundle-image --ramdisk true -i kvm-kernel/initrd-2.6.32-279.14.1.el6.x86_64.img
# euca-upload-bundle -b ramdisk.001 -m /tmp/initrd-2.6.32-279.14.1.el6.x86_64.img.manifest.xml
# euca-register -a x86_64 ramdisk.001/initrd-2.6.32-279.14.1.el6.x86_64.img.manifest.xml
IMAGE   eri-31F837E3

# euca-bundle-image --kernel eki-945F390D --ramdisk eri-31F837E3 -i centos-6.3-x86_64.img
# euca-upload-bundle -b machine.001 -m /tmp/centos-6.3-x86_64.img.manifest.xml
# euca-register -a x86_64 machine.001/centos-6.3-x86_64.img.manifest.xml
IMAGE   emi-69183D43
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;でテキトーに起動してログインします。&lt;/p&gt;

&lt;h1 id=&#34;euca-monkey-のインストール&#34;&gt;Euca Monkey のインストール&lt;/h1&gt;

&lt;p&gt;Kyo Lee さんのブログや README によれば「10ステップでインストールできるぜ」と言ってますので、以下の10ステップを実行します。&lt;/p&gt;

&lt;h2 id=&#34;ステップ-1&#34;&gt;ステップ 1&lt;/h2&gt;

&lt;p&gt;git のインストール&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# yum -y install git
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ステップ-2&#34;&gt;ステップ 2&lt;/h2&gt;

&lt;p&gt;github から euca-monkey のソースを取得&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;git clone https://github.com/eucalyptus/euca-monkey.git
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ステップ-3&#34;&gt;ステップ 3&lt;/h2&gt;

&lt;p&gt;ディレクトリ euca-monkey/ 配下に移動&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cd ./euca-monkey
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ステップ-4&#34;&gt;ステップ 4&lt;/h2&gt;

&lt;p&gt;cloud-resource-populator のインストーラを実行&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;../installer-cloud-resource-populator.py
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、スクリプトの実行が終ると4ステップの手順が示されるけどガン無視して次に進みます。&lt;/p&gt;

&lt;h2 id=&#34;ステップ-5&#34;&gt;ステップ 5&lt;/h2&gt;

&lt;p&gt;euca-monkey-webservice のインストーラを実行 (いまさらだけど、HTTP proxy 配下の環境で実行している人は yum にちゃんと proxy の設定してネ)。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;../installer-euca-monkey-webservice.py
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ステップ-6&#34;&gt;ステップ 6&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/20121203_0.png&#34; alt=&#34;Euca Monkey の初期画面&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Euca Monkey のページ (http://インスタンスのIP/euca-monkey.php) にブラウザでアクセスして、ちゃんと動いているか確認&lt;/p&gt;

&lt;p&gt;あ、ちなみに事前にセキュリティグループの 80/tcp は開けといてね。あとインスタンス上でファイアウォールが有効になっている場合は system-config-firewall-tui コマンドとかで適宜 80/tcp を開けてね。&lt;/p&gt;

&lt;h2 id=&#34;ステップ-7&#34;&gt;ステップ 7&lt;/h2&gt;

&lt;p&gt;ディレクトリ launch_euca_monkey/ 配下に移動&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cd ./launch_euca_monkey/
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ステップ-8&#34;&gt;ステップ 8&lt;/h2&gt;

&lt;p&gt;../conf/ ディレクトリ配下にある Euca Monkey の設定ファイル 2b_tested.lst と generator.ini を適宜変更します。&lt;/p&gt;

&lt;p&gt;私の環境では以下の内容&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;./conf/2b_tested.lst&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;192.168.33.102  UBUNTU  12.04   64      REPO    [UI CC00 CLC SC00 WS]
192.168.33.101  UBUNTU  12.04   64      REPO    [NC00]
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;./conf/generator.ini&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;### RESOURCE GENERATOR PARAMETERS

[USER INFO]
account: cloud-user-test-acct-00
user: cloud-user-00
password: mypassword00

[RESOURCES]
running instances: 2
volumes:  2
snapshots: 1
security groups: 3
keypairs: 5
ip addresses: 2

[ITERATIONS]
iterations: 10
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;本当は RESOURCES や ITERATIONS の値を大きくしたいんですが、このあと OpenStack Advent Calendar のネタも書かなきゃならないので、日和って小さくしました。(この時点で &lt;sup&gt;12&lt;/sup&gt;&amp;frasl;&lt;sub&gt;03&lt;/sub&gt; 19:10 &amp;hellip;(^o^)/)&lt;/p&gt;

&lt;h2 id=&#34;ステップ-9&#34;&gt;ステップ 9&lt;/h2&gt;

&lt;p&gt;Euca Monkey を起動&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;../launch-euca-monkey.py
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;実行すると画面にポロポロっと下拵えの様子が出力されて、準備が完了すると&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;===== LAUNCH EUCA MONKEY : DONE =====
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;って出力されます。あとは裏でバリバリっと動くのです。&lt;/p&gt;

&lt;h2 id=&#34;ステップ-10&#34;&gt;ステップ 10&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;http://blog.osamu.habuka.jp/images/20121203_1.png&#34; alt=&#34;期待のグラフががががが…？&#34; /&gt;&lt;/p&gt;

&lt;p&gt;で、コンソールを眺めてても何も起きません。そりゃそうです、実行結果はブラウザでステップ 6 でアクセスした場所を表示し、画面上部の [Refresh] ボタンをクリックして画面を更新します。するとモリモリ………って、あれ？画面左側の INPUT GRAPH しか描画されないお…(´・ω・`)&lt;/p&gt;

&lt;p&gt;Euca Monkey のテストのログを見ると INPUT 側のログには&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2012-12-03:20:07:20     cloud-user-test-acct-00 admin   intellilink     2       2       1       3       5       2
2012-12-03:20:07:25     cloud-user-test-acct-00 admin   intellilink     0       0       0       0       0       0
(省略)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;って吐かれてるのに、一方の結果のログには&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2012-12-03:20:07:23     cloud-user-test-acct-00 admin   intellilink     -1      -1      -1      -1      -1      -1
2012-12-03:20:07:27     cloud-user-test-acct-00 admin   intellilink     -1      -1      -1      -1      -1      -1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;って吐かれてる…。どうみてもこれ失敗してるよなぁ。。。&lt;/p&gt;

&lt;p&gt;で、ここで今更気付くのが羽深クオリティなんですが、そーいや Kyo Lee さんのブログのポスト見ると Eucalyptus 3.2 で実装されてる UI が写ってる…。もしかして Euca Monkey って 3.1 じゃ動かない？ (そんな記述は見当たらないんだけどなぁ。。。)&lt;/p&gt;

&lt;p&gt;ということで、Kyo Lee さんに質問し、今日はここまで。(&lt;sup&gt;12&lt;/sup&gt;&amp;frasl;&lt;sub&gt;01&lt;/sub&gt; のエントリに引き続き、こんなんばっか… T^T)&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&#34;openstack-を徹底的にイジメ抜く-許さない-絶対&#34;&gt;OpenStack を徹底的にイジメ抜く、許さない、絶対&lt;/h1&gt;

&lt;p&gt;Euca Monkey で消化不良な結末を迎えたので、思わず OpenStack Advent Calendar のことを忘れて今日を終えるところでした…。&lt;/p&gt;

&lt;p&gt;さて、気持ちを切り替えて頑張ります。&lt;/p&gt;

&lt;p&gt;えーと、タイトルは強気ですが、ぶっちゃけアタクシ OpenStack 初心者なのです (一部の人達には誤解されていますが…)。なので、初心者は初心者らしく、&lt;a href=&#34;http://www.ospn.jp/press/20121108no29-1-useit-oss.html&#34;&gt;dodai-deploy を使って環境を作成&lt;/a&gt;します。&lt;/p&gt;

&lt;p&gt;そしてこれは「ネタ」なので、書いてあることに対してスルー力が必要です。むしろこの日記自体をスルーしてくれると個人的には助かります。( ´_ゝ｀)&lt;/p&gt;

&lt;p&gt;… … …&lt;/p&gt;

&lt;p&gt;… … …&lt;/p&gt;

&lt;p&gt;… … …&lt;/p&gt;

&lt;p&gt;(…3時間経過…)&lt;/p&gt;

&lt;p&gt;… … …&lt;/p&gt;

&lt;p&gt;… … …&lt;/p&gt;

&lt;p&gt;… … …&lt;/p&gt;

&lt;p&gt;OpenStack を泣かす前に自分が泣きそうな状況になりましたよ。ツールに頼ってばかりではいけませんね… T&amp;amp;T&lt;/p&gt;

&lt;p&gt;&lt;font size=&#34;5&#34;&gt;教訓： (またこのパターンかよ…) OpenStack ぐらい手動で構築できるようにならないとダメです。&lt;/font&gt;&lt;/p&gt;

&lt;h1 id=&#34;glance-を泣かしてみる&#34;&gt;glance を泣かしてみる&lt;/h1&gt;

&lt;p&gt;何度も言いますが本当に OpenStack 初心者なので、OpenStacker 的には当然なことも僕にはワカラナイので「オイオイ、そんな使い方はねーだろーよ？」ってことをやっちゃってるかもしれません。&lt;/p&gt;

&lt;p&gt;Eucalyptus だろうが OpenStack だろうが、まずはマシンイメージを登録しないことには始まりません。なので華麗にマシンイメージを登録してみたいと思います。&lt;/p&gt;

&lt;p&gt;ちなみに、世の中的には glance にマシンイメージを追加するときは glance コマンドを使うようですが、僕は Eucalyptoid なので glance コマンドの使い方を知りません。なので意地でも euca2ools でイメージを登録してます。で、Horizon さんは素敵な方なので EC2 認証情報の zip ファイルをダウンロードさせてくれるのですが、その中にある ec2rc.sh の中には S3_URL に関する記述がないんです、何でだろう？僕の設定が悪いんですよねきっと、はい。&lt;/p&gt;

&lt;p&gt;まぁ、なので毎回以下のように環境にあわせて設定してます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;S3_URL=http://192.168.33.101:3333
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、早速、おまちかねのイメージ登録です。ただし、普通に登録したのではツマラナイので、以下のスクリプトを用意し、1つのイメージを並列で登録してみました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#!/bin/bash -x

WD=$(basename `pwd`)
KERNEL_IMG=`ls kernel-*`
RAMDISK_IMG=`ls initramfs-*`
MACHINE_IMG=`ls ${WD}.img`
BUCKET=`date +&#39;%Y%m%d-%H%M%S&#39;`

echo ${KERNEL_IMG}
echo ${RAMDISK_IMG}
echo ${MACHINE_IMG}

mkdir -p /mnt/tmp-${BUCKET}

euca-bundle-image -d /mnt/tmp-${BUCKET}/ -i ${KERNEL_IMG} --kernel true
euca-upload-bundle -b ${BUCKET} -m /mnt/tmp-${BUCKET}/${KERNEL_IMG}.manifest.xml
EKI=`euca-register ${BUCKET}/${KERNEL_IMG}.manifest.xml | gawk &#39;{print $2}&#39;`

euca-bundle-image -d /mnt/tmp-${BUCKET}/ -i ${RAMDISK_IMG} --ramdisk true
euca-upload-bundle -b ${BUCKET} -m /mnt/tmp-${BUCKET}/${RAMDISK_IMG}.manifest.xml
ERI=`euca-register ${BUCKET}/${RAMDISK_IMG}.manifest.xml | gawk &#39;{print $2}&#39;`

euca-bundle-image -d /mnt/tmp-${BUCKET}/ -i ${MACHINE_IMG} --kernel ${EKI} --ramdisk ${ERI}
euca-upload-bundle -b ${BUCKET} -m /mnt/tmp-${BUCKET}/${MACHINE_IMG}.manifest.xml
euca-register --architecture x86_64 ${BUCKET}/${MACHINE_IMG}.manifest.xml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、このスクリプトを6並列実行したところで、えーと、何ていいましょう、まぁ、普通ありえないとは思うのですが、私の環境はちょっと特殊でして、まぁ、以下を見てください。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda2       9.2G  3.5G  5.3G  40% /
udev            7.8G  4.0K  7.8G   1% /dev
tmpfs           3.2G  280K  3.2G   1% /run
none            5.0M     0  5.0M   0% /run/lock
none            7.8G     0  7.8G   0% /run/shm
cgroup          7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/sda5       445G   13G  410G   4% /mnt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;まぁ、聡明な OpenStacker の皆さんならばきっとこれを見て &lt;strong&gt;m9(^Д^)&lt;/strong&gt; ってなっていると思います。そう、実は /dev/sda5 にはいくつかディレクトリを用意しておいて、それらを /var/lib/glance/ や /tmp/ に bind マウントして今回のスクリプトを実行して&lt;/p&gt;

&lt;p&gt;&lt;font size=&#34;4&#34;&gt;いえ～ぃ、glance&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:1&#34;&gt;&lt;a rel=&#34;footnote&#34; href=&#34;#fn:1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; ジャイアントロック～www&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;って笑う予定でした。ところがそのマウント行為をすっかり忘れてしまい、当然ながらディスクフルを起してしまい、glance も nova-objectsoter も動作がおかしくなり、おまけに「やべー、12/03 の Advent Calendarに穴あけちゃうよー」って思って慌てて環境を掃除して再起動してみましたが、刻すでに遅し&lt;/p&gt;

&lt;p&gt;/var/log/nova-api.log を見ると&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2012-12-03 23:10:42 ERROR nova.api.openstack [req-7f54c557-1f6c-42f2-aa74-dd6ff5fd26b9 aac09b12b22d4f1b85bd8339d6688a43 f045
25346fd94c19a2a098212b93c5e6] Caught error: (OperationalError) (2003, &amp;quot;Can&#39;t connect to MySQL server on &#39;192.168.33.101&#39; (11
1)&amp;quot;) None None
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;なんて素敵なエラーが吐かれています。mysql の DB が壊れてしまったんでしょうか？もうこの時点で &lt;sup&gt;12&lt;/sup&gt;&amp;frasl;&lt;sub&gt;03&lt;/sub&gt; の終りが目前なのでそろそろオチを探さないとイケないのですが、まぁ、Twitter で事前にツブやいていたように&lt;/p&gt;

&lt;p&gt;&lt;font size=&#34;5&#34; color=&#34;#ff2222&#34;&gt;OpenStack に徹底的にイジメられる、許して、マジで&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;という結果になりました。ホント OpenStack コワイです。はい。&lt;/p&gt;

&lt;p&gt;終り。&lt;/p&gt;

&lt;p&gt;(ちなみに glance に euca2ools で同時にイメージを登録するとジャイアントロックされるのって diablo までですかね？もうとっくに並列処理可能になってます？)&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;

&lt;hr /&gt;

&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;同僚から「節子、何叩いとるんや！これ nova-objectstore やろ。glance ちゃうやんか！！」とツッコまれました(；´Д`A
 &lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:1&#34;&gt;&lt;sup&gt;[return]&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>