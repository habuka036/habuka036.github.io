
<!DOCTYPE html>
<html lang="ja-jp">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" CloudStack Advent Calendar jp: 2012 &amp; Eucalyptus Advent Caledar 2012 JP 廿四日目 &middot;  hablog" />
        <meta property="og:site_name" content="hablog" />
        <meta property="og:url" content="http://blog.osamu.habuka.jp/post/2012-12-24.eucalyptus-adventcalendar-2012-jp-day-24/" />

    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2012-12-24T01:19:16&#43;09:00" />
        <meta property="og:article:tag" content="CloudStack" />
        <meta property="og:article:tag" content="Eucalyptus" />
        <meta property="og:article:tag" content="AdventCalendar" />
        

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@" />
        <meta name="twitter:creator" content="@" />
        <meta name="twitter:title" content="CloudStack Advent Calendar jp: 2012 &amp; Eucalyptus Advent Caledar 2012 JP 廿四日目" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:url" content="http://blog.osamu.habuka.jp/post/2012-12-24.eucalyptus-adventcalendar-2012-jp-day-24/" />
    

        <title> CloudStack Advent Calendar jp: 2012 &amp; Eucalyptus Advent Caledar 2012 JP 廿四日目 &middot;  hablog</title>

    
        <meta name="description" content="" />
    

        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
        

    
        <link href="http://blog.osamu.habuka.jp/index.xml" rel="alternate" type="application/rss+xml" title="hablog" />
    

    
        <link rel="canonical" href="http://blog.osamu.habuka.jp/post/2012-12-24.eucalyptus-adventcalendar-2012-jp-day-24/" />

    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "CloudStack Advent Calendar jp: 2012 &amp; Eucalyptus Advent Caledar 2012 JP 廿四日目",
        "author": {
            "@type": "Person",
            "name": "http://profiles.google.com/?rel=author"
        },
        "datePublished": "2012-12-24",
        "description": "",
        "wordCount": 1084
    }

    </script>

    <script type="text/javascript">
    
    

    </script>
    

    <style>
@charset "UTF-8";article,header,img,main,nav,section{display:block}blockquote,p,pre,ul{margin:2em auto}#wrapper,pre{width:100%;box-sizing:border-box}#nav,#wrapper,code{position:relative}#nav,body{background:#fff}#menu,blockquote,pre code{background:0 0}#menu,#menu .menu-header,#menu .menu-list,#wrapper,.post-nav .post-nav-item .post-nav-teaser .post-nav-info,blockquote,pre{box-sizing:border-box}img{border:0;max-width:100%;height:auto;margin:2.5em auto}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}code,pre{font-family:monospace,monospace;font-size:1em}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:300;src:local("Merriweather Sans Light"),local("MerriweatherSans-Light"),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowY_zIojJi0m4a5Z6tRh6itY.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:400;src:local("Merriweather Sans Regular"),local("MerriweatherSans-Regular"),url(//fonts.gstatic.com/s/merriweathersans/v5/AKu1CjQ4qnV8MUltkAX3sL2aU247V0zTzydO4RoO9Ok.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:700;src:local("Merriweather Sans Bold"),local("MerriweatherSans-Bold"),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowQfd-b-I5PxxcmB4_-MNcqw.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:800;src:local("Merriweather Sans ExtraBold"),local("MerriweatherSans-ExtraBold"),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowWT7sFQ1Iz1BbpcuCPlgc9Q.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:300;src:local("Merriweather Sans Light Italic"),local("MerriweatherSans-LightItalic"),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVX9UU5BmOJGkLxUCVv5VXdc.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:400;src:local("Merriweather Sans Italic"),local("MerriweatherSans-Italic"),url(//fonts.gstatic.com/s/merriweathersans/v5/3Mz4hOHzs2npRMG3B1ascf0KIgDhPIHb_R-SWdtqte8.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:700;src:local("Merriweather Sans Bold Italic"),local("MerriweatherSans-BoldItalic"),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVYM8pfYvjMoOxygpzLVILAs.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-weight:400;src:local("Inconsolata"),url(//fonts.gstatic.com/s/inconsolata/v12/BjAYBlHtW3CJxDcjzrnZCIbN6UDyHWBl620a-IRfuBk.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-weight:700;src:local("Inconsolata Bold"),local("Inconsolata-Bold"),url(//fonts.gstatic.com/s/inconsolata/v12/AIed271kqQlcIRSOnQH0yTqR_3kx9_hJXbbyU8S6IN0.woff) format("woff")}@font-face{font-family:icons;src:url(/fonts/icons.eot?9273991);src:url(/fonts/icons.eot?9273991#iefix) format("embedded-opentype"),url(/fonts/icons.woff?9273991) format("woff"),url(/fonts/icons.ttf?9273991) format("truetype"),url(/fonts/icons.svg?9273991#icons) format("svg");font-weight:400;font-style:normal}[class^=icon-]:before{font-family:icons;font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-arrow-left:before{content:'\e804'}.icon-arrow-right:before{content:'\e807'}.icon-rss:before{content:'\e808'}.icon-menu:before{content:'\e809'}body{margin:0;font:300 1em/1.5em 'Merriweather Sans',sans-serif;color:#595B66}blockquote,i{font-style:italic}code,pre{font-family:Inconsolata,monospace}a,blockquote,code,i{font-weight:400}::-moz-selection{color:#222;background:#D6EDFF;text-shadow:none}::-moz-selection,::selection{color:#222;background:#D6EDFF;text-shadow:none}a{background-color:transparent;color:inherit;text-decoration:none;transition:all ease-out .2s}.post-content a{border-bottom:2px solid #36D995}h1,h4{text-rendering:optimizeLegibility;color:#1F2026}h1{font-size:2em;line-height:1em;margin:2em 0 -.5em}h4{font-size:1.25em;line-height:1.2em;margin:2.4em 0 -.8em}ul{list-style:none;padding-left:3em}blockquote{padding:0 1em;border-left:.25em solid #D4D5D9;color:#595B66}blockquote *{margin:1em auto}blockquote :first-child{margin-top:0}blockquote :last-child{margin-bottom:0}i{color:#363740}code{display:inline-block;top:-1px;padding:3px 6px;margin:-1px 2px;font-size:.875em;line-height:1.143em;background:#E1E2E6;color:#000;border-radius:2px}pre{padding:1em;white-space:pre;overflow:auto;background:#9D9FA6;color:#fff}pre code{position:static;top:auto;font-size:1em;line-height:1.5em;white-space:-moz-pre-wrap;white-space:pre-wrap;vertical-align:inherit;border:none;padding:0}#menu .menu-header:before,.post .post-title:before{border-bottom:4px solid #36D995;content:''}.inner{max-width:48em;margin:0 auto;padding:0 1em}#wrapper{min-height:100vh;padding-bottom:6em;background:#F2F3F5}#push{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;opacity:1}#nav{z-index:70;transition:all ease-out .4s;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;opacity:1}#nav:after{clear:both;content:'';display:table}#nav .nav-logo{float:left;height:2em;padding:1em;max-width:50%}#nav .nav-logo img{width:auto;max-width:none;height:2em;margin:0}#nav .nav-menu{float:right}#nav .nav-menu:after{clear:both;content:'';display:table}#nav .nav-menu a{display:block;width:1em;height:1em;line-height:1em;padding:1.5em;text-align:center;float:left;cursor:pointer}#nav .nav-menu a i:before{margin:auto}#menu{display:none;position:fixed;left:50%;top:5%;width:30em;height:90%;margin-left:-15em;padding:3em 0 0;overflow:hidden;transition:all ease-out .3s;-webkit-transform:translate3d(0,2em,0);transform:translate3d(0,2em,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;opacity:0;z-index:100}@media only screen and (max-width:50em){#menu{width:90%;left:5%;margin-left:auto}}#menu .menu-header{position:absolute;left:0;top:0;width:100%;height:3.5em;padding:1em 1.5em .5em;margin-bottom:1em;line-height:2em;z-index:110;background:#fff}#menu .menu-header:before{position:absolute;left:-5%;bottom:-1em;width:110%;height:2em;background:#fff;box-shadow:0 .125em .125em rgba(0,0,0,.1);-webkit-transform:rotate(2.5deg);transform:rotate(2.5deg);transition:all ease-out .2s;z-index:115}#menu .menu-header:after{clear:both;content:'';display:table}#menu .menu-header .menu-label{position:relative;display:block;float:left;z-index:120}#menu .menu-header .menu-close{position:relative;display:block;float:right;width:2em;height:2em;padding:1em;margin:-1em -1.5em -1em 0;cursor:pointer;z-index:125}#menu .menu-header .menu-close:after,#menu .menu-header .menu-close:before{content:'';position:absolute;left:50%;top:50%;background:#9D9FA6;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.overlay,.overlay:before{top:0;width:100%;height:100%}#menu .menu-header .menu-close:after{width:2px;height:1em;margin:-.5em 0 0 -1px}#menu .menu-header .menu-close:before{width:1em;height:2px;margin:-1px 0 0 -.5em}#menu .menu-list{position:relative;list-style:none;margin:0;padding:2em 0;height:100%;overflow-x:hidden;overflow-y:scroll;background:#fff}.overlay{position:fixed;left:0;z-index:80;display:none}.overlay:before{content:'';position:absolute;left:0;background:#1F2026;opacity:0;transition:all ease-out .3s;-webkit-transform-style:preserve-3d;transform-style:preserve-3d}.post{position:relative;z-index:20}.post .post-meta{display:block;font-size:.75em;line-height:1.334em;font-weight:400;margin-bottom:1.334em}.post .post-title{position:relative;color:#000;font-size:2em;line-height:1.375em;font-weight:800;text-indent:-1px;margin:.25em 0 .75em}.post .post-title:before{position:absolute;left:0;bottom:-.334em;width:1em;margin-bottom:-2px}.post .post-header{padding:4em 0 0;margin-bottom:3em}.post-footer .post-share a span{display:none}.post-nav .post-nav-item{position:fixed;top:50%;display:block;margin-top:-4em;overflow:hidden;border-radius:10em;transition:none}@media only screen and (max-width:70em){.post-nav .post-nav-item{position:absolute;top:auto;margin:auto;max-width:50%}}.post-nav .post-nav-item.post-nav-next{left:0;text-align:left}.post-nav .post-nav-item.post-nav-next .post-nav-icon{float:left}.post-nav .post-nav-item.post-nav-next .post-nav-icon i{left:-.05em}.post-nav .post-nav-item.post-nav-next .post-nav-info{padding-left:6em}.post-nav .post-nav-item.post-nav-prev{right:0;text-align:right}.post-nav .post-nav-item.post-nav-prev .post-nav-icon{float:right}.post-nav .post-nav-item.post-nav-prev .post-nav-icon i{right:-.05em}.post-nav .post-nav-item.post-nav-prev .post-nav-info{padding-right:6em}.post-nav .post-nav-item .post-nav-teaser{display:block;padding:1em;transition:all ease-out .2s;max-width:25em;overflow:visible}.post-nav .post-nav-item .post-nav-teaser:after{clear:both;content:'';display:table}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon{display:block;width:5em;height:5em;line-height:5em;text-align:center;box-sizing:border-box;border-radius:10em;border:1px solid #36D995;box-shadow:0 0 0 0 transparent;transition:all ease-out .1s;background:#F2F3F5}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon i{position:relative;font-size:2em}@media only screen and (max-width:30em){.post-nav .post-nav-item .post-nav-teaser .post-nav-icon{width:4em;height:4em;line-height:4em}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon i{font-size:1.5em}}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon i:before{margin:auto}.post-nav .post-nav-item .post-nav-teaser .post-nav-info{display:none;width:100%;transition:all ease-out .2s}.post-nav .post-nav-item .post-nav-teaser .post-nav-info .post-nav-title{display:block;max-height:1.25em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin:1.25em 0 .25em;font-size:1em;line-height:1.25em;font-weight:700;color:#363740}.post-nav .post-nav-item .post-nav-teaser .post-nav-info .post-nav-excerpt{display:block;max-height:1.334em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin:0;font-size:.75em;line-height:1.334em;font-weight:400;color:#9D9FA6}
</style>


    </head>
    <body class="home-template" style="display: none;">
      <section id="wrapper">
        <div id="ajax-container">
          <nav id="nav" class="nav">
            <div class="nav-logo">
              <a href="http://blog.osamu.habuka.jp/">
      			  	
      			  	
      			  	<img src="/images/puta-su.png" alt="Logo"/>
      			  	
              </a>
			  	    
            </div>
            <div class="nav-menu">
              <a class="rss" href="">
                <i class="icon-rss"></i>
              </a>
                
                <a class="menu" data-action="toc" data-target="toc"><i class="icon-location"></i></a>
                
                
            </div>
          </nav>


<main class="content" role="main">
	<article class="post">
		<div class="inner">

			<div id="push">

  			<header class="post-header">
  				<span class="post-meta">
						<span class="post-date">24 Dec 2012</span> <span class="reading-time">| <span class="estimated-reading-time">6 min.</span> (<span class="word-count">1084</span> words)</span></span>
  				</span>
  				<div class="clear"></div>
  				<h1 class="post-title">CloudStack Advent Calendar jp: 2012 &amp; Eucalyptus Advent Caledar 2012 JP 廿四日目</h1>
  			</header>

  			<section class="post-content">
  				

<h1 id="手取り足取りの難しさ">手取り足取りの難しさ</h1>

<p>さて皆さん本日はクリスマスイブですよ、聖なるクリスマスを迎える準備はできましたか？泣いても笑ってもサンタはやって来ます、皆さん供物の用意は済みましたか？もしくは供物のかわりに差し出す魂の用意は大丈夫ですか？清らかな人生を歩んできましたか？</p>

<h1 id="cloudstackがッ-泣くまで-イジメるのをやめないッ">CloudStackがッ 泣くまで イジメるのをやめないッ！</h1>

<p>はい、さて、CloudStack の Advent Calendar です。あ、ちなみに始めにお斷りしておきますが、間違ってもこれをカップルで仲良く読みながらホーリーナイトとか口走ってしまわないように注意してください。もし口走ると国境付近の山に封印されているサンタがうっかり掘り起こされて街中の子供達が連れ去られたりトナカイちゃんが美味しく食べられてもおかしくないことになったり、もうそりゃぁ大変なことになります。</p>

<p>あ、はい、うざいですね、ごめんなさい、そろそろ本題に入りますね。
えー、タイトルのとおり CloudStack をこれでもかっていうぐらいイジめて泣かそうという、僕の優しさが隠しきれないほど滲みでる企画です。</p>

<h2 id="参考にした情報">参考にした情報</h2>

<ul>
<li>クリエーションライン株式会社の資料 <a href="http://www.creationline.com/lab/1963">CloudStackを使ってみよう[1]</a></li>
<li>大削先生の記事 <a href="http://techtarget.itmedia.co.jp/tt/news/1204/19/news03.html">機能を徹底比較！　～Eucalyptus、CloudStack、OpenStack</a></li>
<li>CloudStack Advent Calendar 1日目の荒井会長の資料 <a href="http://www.slideshare.net/YasuhiroArai/apache-cloudstack-40-ver05">Apache CloudStack 4.0をインストールしてみた。</a></li>
<li>CloudStack の <a href="http://incubator.apache.org/cloudstack/docs/en-US/Apache_CloudStack/4.0.0-incubating/html/Installation_Guide/index.html">Installation Guide</a></li>
<li><a href="http://kralis.dip.jp/wiki/index.php?CloudStack4.0-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">CloudStack4.0-インストール</a></li>
<li>大削先生のスライド <a href="http://www.slideshare.net/star76/osc2012-cloud-cloudstack">CloudStack 概要 でもちょっと詳しめVer.</a></li>
</ul>

<p>あ、ちなみに上記の素晴しい資料を参考にしたからと言って、僕の貧相な理解力がこれらを吸収できるか？っていうと、それは全く別の話ですよ。</p>

<h2 id="構成">構成</h2>

<p>本当は Host を 2台にしたかったんですが、機材不足で断念しました。なので以下の構成にしています。</p>

<pre><code>+------------+    +--------+
| CloudStack |    |        |
| Management +----+  Host1 |
|   Server   |    |        |
+------------+    +--------+
</code></pre>

<h2 id="構築">構築</h2>

<p>聖なる CloudStacker の皆さんは「構築なんて目つぶっててもできることをわざわざ書くな」と呆られるかもしれませんが、まぁ聞いてくださいよ。
えーとですね、私えらい離れた環境から CloudStack のインストールをやっておりまして、どれだけ離れているかというと、以下のように対象マシンに接続するために 2 台ほど踏み台を通らないと駄目なんす。</p>

<pre><code>+------------+    +---------+    +---------+    +-------+
| CloudStack |    |         |    |         |    |       |
| Management +----+ ladder1 +----+ ladder2 +----+ My PC |
|   Server   |    |         |    |         |    |       |
+------------+    +---------+    +---------+    +-------+
</code></pre>

<p>で、ladder1 と ladder2 にはそれぞれ stone を用意し、また諸般の事情から以下のような経路となっていました。</p>

<pre><code>+------------+    +---------+    +---------+    +-------+
| CloudStack |    |         |    |         |    |       |
| Management +----+ ladder1 +----+ ladder2 +----+ My PC |
|   Server   |    |         |    |         |    |       |
+------------+    +---------+    +---------+    +-------+
      tcp/8080 &lt;=   tcp/38080 &lt;=    tcp/8080 &lt;=
</code></pre>

<p>そんで <a href="http://ladder2:8080/client">http://ladder2:8080/client</a> にアクセスしログインを試みるも、以下のようにログインできないんです。まぁ、純真な僕は最初は本当にユーザ名かパスワードが間違っているんじゃないかと何度も入力し直したり、諸々のドキュメントや文献を漁ったり、生活態度を改めようかどうか悩んだりもしました。</p>

<p><img src="/images/20121224_0.png" alt="ログイン画面" /></p>

<p>で、最後の手段として CloudStacker の皆さんにも聞いてみようと思ったのですが、それには最低限素人でも収集できる情報ぐらいは確認しておかないと聖なる CloudStacker にボッコボコにされるんじゃないかと思い、とりあえず僕のようなしょぼくれ技術者でも確認できることとして、Management Server で tcpdump を叩いて認証のデータがちゃんと届いているかを見ようと考えました。</p>

<pre><code># tcpdump -i eth0 -vXx tcp port 8080
</code></pre>

<p>すると以下のように認証情報が流れてきました。</p>

<pre><code>        0x0000:  4500 00b4 cee6 4000 3f06 a9eb c0a8 2015  E.....@.?.......
        0x0010:  c0a8 210c df9d 1f90 bcfd 8b07 6fd9 dff5  ..!.........o...
        0x0020:  8018 01c9 9e37 0000 0101 080a 8891 4a06  .....7........J.
        0x0030:  06fd 7bb8 3066 3766 3139 3730 6335 3430  ..{.0f7f1970c540
        0x0040:  3133 6235 3664 3432 3631 3036 3966 3566  13b56d4261069f5f
        0x0050:  350d 0a0d 0a63 6f6d 6d61 6e64 3d6c 6f67  5....command=log
        0x0060:  696e 2675 7365 726e 616d 653d 6164 6d69  in&amp;username=admi
        0x0070:  6e26 7061 7373 776f 7264 3d35 6634 6463  n&amp;password=5f4dc
        0x0080:  6333 6235 6161 3736 3564 3631 6438 3332  c3b5aa765d61d832
        0x0090:  3764 6562 3838 3263 6639 3926 646f 6d61  7deb882cf99&amp;doma
        0x00a0:  696e 3d25 3246 2672 6573 706f 6e73 653d  in=%2F&amp;response=
        0x00b0:  6a73 6f6e                                json
</code></pre>

<p>で、暗号化されたパスワードは5f4dcc3b5aa765d61d8327deb882cf99であることがわかります。では Management Server 側のパスワードは？ということで MySQL のデータを覗いてみます。</p>

<pre><code>mysql&gt; select password from user where username = 'admin';
+----------------------------------+
| password                         |
+----------------------------------+
| 5f4dcc3b5aa765d61d8327deb882cf99 |
+----------------------------------+
1 row in set (0.00 sec)
</code></pre>

<p>あれあれ？パスワードちゃんと一致してますよね？おかしいですね？エラーメッセージさんどーゆーことですか？</p>

<p>で、ここでふと思いだしました、荒井会長のスライドの p.15 に「外部に公開する場合は、リバースProxyを中間において、HTTPS設定をしておくことがおすすめ。」と書いてあることを。あれ？もしかして TCP relay で引き回しちゃ駄目なのかしら？</p>

<p>もうこの時点で軟弱野郎の僕は「よし、つまりアレだな、これって僕にとっての CloudStack とはユーザ名とパスワードを入力して認証エラーを出すだけのソフトウェアなんだな」と理解しようとしましたが、さすがに「インストール画面すら触っていません」という結果だと ホーリー CloudStacker に</p>

<p><font size=5>m9(＾Д ＾）プギャー</font></p>

<p>と笑われること必死です。なので、荒井会長のご神託に従ってリバース Proxy を中間に置いてみました。以下のように。</p>

<pre><code>+------------+    +--------+    +-------+    +-------+
| CloudStack |    | Proxy  |    |       |    |       |
| Management +----+ Server +----+ Stone +----+ My PC |
|   Server   |    |        |    |       |    |       |
+------------+    +--------+    +-------+    +-------+
      tcp/8080 &lt;=     tcp/80 &lt;=  tcp/8080 &lt;=
</code></pre>

<p>ちなみに Proxy Server としている Apache の設定の該当部分は以下です。</p>

<pre><code>        &lt;Location /client/&gt;
                ProxyPass http://192.168.33.12:8080/client/
                ProxyPassReverse http://192.168.33.12:8080/client/
        &lt;/Location&gt;
</code></pre>

<p>するとどうでしょう？残念なことにインストール画面にログインできてしまいました。ギギギギギ</p>

<p>仕方がないので諦めてポチポチッと各項目を入力していきます。いきますが、不勉強な僕はこれらの各値についていまいちピンときていないので、何度か寝落ちしながら進めていきましたところ、最終的に以下ような素敵なメッセージが返されました。まぁ、そりゃそうですよね、簡単にインストールできるための Web UI で寝落ちしながら作業するウツケモノには神罰が下ってもおかしくないところ、心優しい CloudStack 神はセッションタイムアウトで許してくださる慈悲深さ…。何言ってんだろう俺？</p>

<p><img src="/images/20121224_2.png" alt="セッションタイムアウト" /></p>

<p>心を入れ換えてもう一度試しました。試しましたが、ホストの追加でエラー発生。「戻ってエラーを修正できます。」なんて有り難いお言葉を頂いたので戻ってみますが、ホストの情報を入力する画面が表示されるだけ…。</p>

<p><img src="/images/20121224_4.png" alt="ホスト追加の失敗" /></p>

<p>入力されている情報に間違いがないので、仕方がないのでもう一度パスワードを入力し直してみて続行してみるも、またもやエラー。</p>

<p>うーん、何か事前設定とか不足しているのかしら？と思って、再度インストールガイドを確認すると、</p>

<pre><code>6.5.1.1.2. KVM Host Additional Requirements
   If shared mountpoint storage is in use, the administrator should ensure that the new host 
   has all the same mountpoints (with storage mounted) as the other hosts in the cluster.
   Make sure the new host has the same network configuration (guest, private, and public network) 
   as other hosts in the cluster.
</code></pre>

<p>あー、はいはい、そうね、そうだよね、NFS の設定をちゃんと確認するはー。で、NFS の設定をちゃんと確認し、ホスト「Host1」でマウントできることを確認し、再度ホストの追加を試しました。<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup></p>

<p>……
……
……</p>

<p>はい、残ー念♪</p>

<p><img src="/images/20121224_6.png" alt="ホスト追加の失敗再び" /></p>

<p>もうね、これは CloudStack 神が「お前みたいなユーカリ野郎に触らせてやる CloudStack なんぞ 1Pod もねぇ！と言ってるに違いないです。意味わからんですよ。</p>

<p>ちなみにホスト「Host1」の /var/log/secure には Manegement Server がログインをし5分後ぐらいに接続を切っている跡が残されているのですが、それ以外は何も情報が見当りませんでしたT^T。っていうか、俺何度ホストの追加試してんだよwww</p>

<pre><code>Dec 24 11:13:53 machine3 sshd[18974]: Accepted password for root from 192.168.33.12 port 44467 ssh2
Dec 24 11:13:53 machine3 sshd[18974]: pam_unix(sshd:session): session opened for user root by (uid=0)
Dec 24 11:19:01 machine3 sshd[18974]: Received disconnect from 192.168.33.12: 11: Closed due to user request.
Dec 24 11:19:01 machine3 sshd[18974]: pam_unix(sshd:session): session closed for user root
Dec 24 11:30:13 machine3 sshd[19107]: Accepted password for root from 192.168.33.12 port 44468 ssh2
Dec 24 11:30:13 machine3 sshd[19107]: pam_unix(sshd:session): session opened for user root by (uid=0)
Dec 24 11:35:21 machine3 sshd[19107]: Received disconnect from 192.168.33.12: 11: Closed due to user request.
Dec 24 11:35:21 machine3 sshd[19107]: pam_unix(sshd:session): session closed for user root
Dec 24 11:37:22 machine3 sshd[19189]: Accepted password for root from 192.168.33.12 port 44469 ssh2
Dec 24 11:37:22 machine3 sshd[19189]: pam_unix(sshd:session): session opened for user root by (uid=0)
Dec 24 11:42:30 machine3 sshd[19189]: Received disconnect from 192.168.33.12: 11: Closed due to user request.
Dec 24 11:42:30 machine3 sshd[19189]: pam_unix(sshd:session): session closed for user root
Dec 24 11:57:19 machine3 sshd[19362]: Accepted password for root from 192.168.33.12 port 44470 ssh2
Dec 24 11:57:19 machine3 sshd[19362]: pam_unix(sshd:session): session opened for user root by (uid=0)
Dec 24 12:02:27 machine3 sshd[19362]: Received disconnect from 192.168.33.12: 11: Closed due to user request.
Dec 24 12:02:27 machine3 sshd[19362]: pam_unix(sshd:session): session closed for user root
Dec 24 12:03:49 machine3 sshd[19442]: Accepted password for root from 192.168.33.12 port 44471 ssh2
Dec 24 12:03:49 machine3 sshd[19442]: pam_unix(sshd:session): session opened for user root by (uid=0)
Dec 24 12:08:57 machine3 sshd[19442]: Received disconnect from 192.168.33.12: 11: Closed due to user request.
Dec 24 12:08:57 machine3 sshd[19442]: pam_unix(sshd:session): session closed for user root
Dec 24 12:11:31 machine3 sshd[19526]: Accepted password for root from 192.168.33.12 port 44472 ssh2
Dec 24 12:11:31 machine3 sshd[19526]: pam_unix(sshd:session): session opened for user root by (uid=0)
Dec 24 12:16:39 machine3 sshd[19526]: Received disconnect from 192.168.33.12: 11: Closed due to user request.
Dec 24 12:16:39 machine3 sshd[19526]: pam_unix(sshd:session): session closed for user root
</code></pre>

<p>えー、まー、非常に残念な結果となりましたが、結論としては</p>

<p><font size=5>&lsquo;ユーカリ脳になると CloudStack のインストールすら満足にできなくなる</font></p>

<p>ことが証明されました。</p>

<p>あぁ、もう、僕この先の人生、CloudStacker に会うことできません。どの面下げて会えというんでしょう？</p>

<h2 id="余談-という名の八つ当たり">「余談」という名の八つ当たり</h2>

<p>まぁ、Eucalyptus も Wakame-VDC に比べるとインストールが面倒な気がしますが、CloudStack はより一層面倒だと思いました。</p>

<h3 id="面倒その壱">面倒その壱</h3>

<p>my.cnf の設定って自動化できないの？まぁ、使用する MySQL が CloudStack でのみ使用するわけではないケースもあるでしょうから、そーゆー場合を考えると自動化するのが簡単じゃないのかもしれないけど、やっぱ初心者的には面倒です。</p>

<h3 id="面倒その弐">面倒その弐</h3>

<p>何でインストール作業が途中から Web コンソールでやることになってんでしょうか？利用者が Web コンソールで利用できるってのはとても良いことだと思いますが、環境構築者が Web コンソールで作業できて嬉しいことってあります？今回の私みたいに利用者セグメントとはネットワーク的に違う場所──つまり遠隔地から環境構築していると Web コンソールで作業するために何段もポートフォワードしたり Proxy 経由して設定するのって面倒です。僕がヘタレだから発見できなかっただけで、きっと CUI でのインストール方法ってあるんですよね？</p>

<h3 id="面倒その参">面倒その参</h3>

<p>ホストの追加が失敗すると「問題が発生しました。戻ってエラーを修正できます。:」って出るんですが、何が原因で失敗したのかが全く示されないので戻っても何も状況は解決しなかったです。せめて何を実行したら失敗したかぐらい言って頂けると嬉しいんですが…。</p>

<h2 id="後日談">後日談</h2>

<p>後日談とか書きましたが、まだ1時間も経ってません。</p>

<p>上記を見てくださった行冨さんから「You! cloud-agent インストールしちゃいな Yo!」と指摘を頂きまして、「え？俺何か読み落してた？」とか思いながらインストールしてみることにしました。個人的には「何で WebUI でのインストールが 5 章に書かれているのに、cloud-agent のインストールが 8 章なんだろう？」と納得がいかないんですが、行冨さんから「Citrix の XenServer だったら Cloud-Agent が不要なんです」と教わり、あぁ、そーゆーものなんだ…と納得することにしました。</p>

<h1 id="deltacloud-で-eucalyptus-を利用してみる">DeltaCloud で Eucalyptus を利用してみる？</h1>

<p>さて、この三日間、家の用事をこなす振りしつつ CloudStack Advent Calendar のことをやっていたら Eucalyptus Advent Caledar の仕込みを忘れていました。本当なら <sup>12</sup>&frasl;<sub>24</sub>, <sup>12</sup>&frasl;<sub>25</sub> の Advent Calendar っていったらそりゃもう否が応にも仏恥義理な内容が用意されているもんですが、CloudStack Advent Calendar をあんな寒い状況にしておいて Eucalyptus Advent Calendar だけ立派にすることはできません。なので、今日の Eucalyptus Advent Calendar は手を抜きます。どれぐらい手抜きかと言うと、この24日間でも一二を争う手抜きっぷりです。そのぐらい手を抜かないと申し訳なくて申し訳なくて。</p>

<h2 id="事前確認">事前確認</h2>

<p>えーと、今日の CloudStack Advent Calendar を読んでくださった聖なる紳士淑女の皆さんはよくわかると思いますが、わたくしつまらない点でハマったりするので、事前に環境の確認とかをしておかないといけません。</p>

<p><a href="http://deltacloud.apache.org/install-deltacloud.html">Delta Cloud のサイト</a>を見ると、以下のパッケージがインストールされている必要があるそうです。</p>

<ul>
<li>ruby と ruby-devel</li>
<li>rubygems</li>
<li>gcc-c++</li>
<li>libxml2 と libxml2-devel</li>
<li>libxslt と libxslt-devel</li>
<li>rake</li>
</ul>

<p>で、本当は CentOS なりを用意してやるところですが、残念ながらわたくしは Gentoo Linux 好きっ娘<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup>なので、Gentoo Linux にインストールしてみる予定で上記のパッケージを確認します。</p>

<ul>
<li>ruby と ruby-devel

<ul>
<li>ruby は ruby 1.8.7 をインストールしておきます。emerge するとき RUBY_TARGETS=&ldquo;ruby18&rdquo; を指定しておかないと ruby 1.9 も入ります。まぁ、どっちがいいのかはわかりませんので、もし 1.9 のほうがいい場合は RUBY_TARGETS=&ldquo;ruby19&rdquo; としてくださいね。ちなみに ruby-devel は Gentoo の場合はありません。</li>
</ul></li>
<li>rubygems

<ul>
<li>まぁ、これも RUBY_TARGETS=&ldquo;ruby18&rdquo; としてインストールします (上で指定した RUBY_TARGETS と同じものを指定します)。</li>
</ul></li>
<li>gcc-c++

<ul>
<li>基本的には既にインストールされていると思いますが、一応、USE=&ldquo;cxx&rdquo; で gcc がインストールされているかを確認します。ちなみに gcc-c++ というパッケージ名ではないので注意を。</li>
</ul></li>
<li>libxml2 と libxml2-devel

<ul>
<li>パッケージ名はまま libxml2 です。Gentoo なので libxml2-devel はありません。</li>
</ul></li>
<li>libxslt と libxslt-devel

<ul>
<li>パッケージ名はまま libxslt です。Gentoo なので libxslt-devel はりません。</li>
</ul></li>
<li>rake

<ul>
<li>パッケージ名はまま rake です。</li>
</ul></li>
</ul>

<h2 id="インストール">インストール</h2>

<p>Delta Cloud の Server のインストールをします。</p>

<pre><code>gem install deltacloud-core
</code></pre>

<p>ちなみに私の環境では以下の gems が一緒にインストールされました。</p>

<pre><code>haml-3.1.7
sinatra-rabbit-1.1.3
crack-0.3.1
rack-accept-0.4.5
json-1.7.5
rest-client-1.6.7
rbovirt-0.0.16
uuidtools-2.1.3
http_connection-1.4.2
xml-simple-1.1.2
aws-2.6.0
waz-storage-1.2.0
cloudservers-0.4.2
cloudfiles-1.5.0.1
openstack-1.0.7
nori-2.0.0
httpi-2.0.0
wasabi-3.0.0
gyoku-1.0.0
akami-1.2.0
savon-2.0.2
trollop-2.0
rbvmomi-1.6.0
deltacloud-core-1.0.5
rack-protection-1.3.2
</code></pre>

<p>当然、環境によってインストールされる gems は異ると思います。</p>

<p>続いて Delta Cloud の Client をインストールします。</p>

<pre><code>gem install deltacloud-client
</code></pre>

<p>ちなみに今回は Server と Client を同じマシンにインストールしたのです。</p>

<h2 id="サーバの実行">サーバの実行</h2>

<p><a href="http://deltacloud.apache.org/run-deltacloud-server.html">DeltaCloud のドキュメント</a>によると以下を実行するとサーバが起動するらしいです。</p>

<pre><code>deltacloudd -i eucalyptus
</code></pre>

<p>で、実行したところ以下の素敵なメッセージが届きました。やったねホーリーナイト♪</p>

<pre><code>Starting Deltacloud API :: eucalyptus :: http://localhost:3001/api

/usr/lib64/ruby/site_ruby/1.8/rubygems/custom_require.rb:55:in `gem_original_require': no such file to load -- require_relative (LoadError)
        from /usr/lib64/ruby/site_ruby/1.8/rubygems/custom_require.rb:55:in `require'
        from /usr/lib64/ruby/gems/1.8/gems/deltacloud-core-1.0.5/lib/deltacloud_rack.rb:16
        from /usr/lib64/ruby/gems/1.8/gems/deltacloud-core-1.0.5/config.ru:23:in `load'
        from /usr/lib64/ruby/gems/1.8/gems/deltacloud-core-1.0.5/config.ru:23
        from /usr/lib64/ruby/gems/1.8/gems/rack-1.4.1/lib/rack/builder.rb:51:in `instance_eval'
        from /usr/lib64/ruby/gems/1.8/gems/rack-1.4.1/lib/rack/builder.rb:51:in `initialize'
        from /usr/lib64/ruby/gems/1.8/gems/deltacloud-core-1.0.5/config.ru:1:in `new'
        from /usr/lib64/ruby/gems/1.8/gems/deltacloud-core-1.0.5/config.ru:1
</code></pre>

<p>で、ここから数々のトラブルを千切っては投げ千切っては投げの快進撃でつき進み、無事に DeltaCloud を利用できるようになる予定なのですが、どうやら続きは夢の国でやらなければならないようです。ごめんなさい。</p>

<p><font size="5" color="#ee2222">いよいよクリスマスは明日です ✌(՞ਊ ՞)✌</font></p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">当然のことながら、ちゃんと Management Server と Host1 がお互いに FQDN で通信できることは確認済みです
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">まぁ、下手の横好きなだけですけどね
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>

  			</section>

  			<footer class="post-footer">
  				<div class="post-tags">
            
            
                <a href="http://blog.osamu.habuka.jp//tags/cloudstack/">CloudStack</a>
            
                <a href="http://blog.osamu.habuka.jp//tags/eucalyptus/">Eucalyptus</a>
            
                <a href="http://blog.osamu.habuka.jp//tags/adventcalendar/">AdventCalendar</a>
            
            
  				</div>
  				<div class="post-share">
  					<a class="icon-twitter" href="https://twitter.com/share?text=CloudStack%20Advent%20Calendar%20jp%3a%202012%20%26%20Eucalyptus%20Advent%20Caledar%202012%20JP%20%e5%bb%bf%e5%9b%9b%e6%97%a5%e7%9b%ae&url=http%3a%2f%2fblog.osamu.habuka.jp%2fpost%2f2012-12-24.eucalyptus-adventcalendar-2012-jp-day-24%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
  						<span>Twitter</span>
  					</a>
  					<a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fblog.osamu.habuka.jp%2fpost%2f2012-12-24.eucalyptus-adventcalendar-2012-jp-day-24%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
  						<span>Facebook</span>
  					</a>
  					<a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fblog.osamu.habuka.jp%2fpost%2f2012-12-24.eucalyptus-adventcalendar-2012-jp-day-24%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
  						<span>Google+</span>
  					</a>
  				</div>
  			</footer>

  			<aside class="post-comments">
    
    
    
</aside>


			</div>

			<nav class="post-nav">
				
					<a class="post-nav-item post-nav-next" href="http://blog.osamu.habuka.jp/post/2012-12-25.eucalyptus-adventcalendar-2012-jp-day-25/">
						<section class="post-nav-teaser">
							<span class="post-nav-icon"><i class="icon-arrow-left"></i></span>
							<span class="post-nav-info">
								<h4 class="post-nav-title">Eucalyptus Advent Calendar 2012 JP 廿五日目</h4>
								<p class="post-nav-excerpt">&hellip;</p>
							</span>
						</section>
					</a>
				
				
					<a class="post-nav-item post-nav-prev" href="http://blog.osamu.habuka.jp/post/2012-12-21.eucalyptus-adventcalendar-2012-jp-day-21/">
						<section class="post-nav-teaser">
							<span class="post-nav-icon"><i class="icon-arrow-right"></i></span>
							<span class="post-nav-info">
								<h4 class="post-nav-title">Eucalyptus Advent Calendar 2012 JP 廿一日目</h4>
								<p class="post-nav-excerpt">&hellip;</p>
							</span>
						</section>
					</a>
				
				<div class="clear"></div>
			</nav>

		</div>
	</article>
</main>

				<div id="body-class" style="display: none;"></div>
				<footer id="footer">
					<section class="credits">
						<span class="credits-theme">Theme <a href="https://github.com/zenithar/hugo-theme-bleak" target="_blank" rel="nofollow">Bleak</a> by <a href="http://zutrinken.com" target="_blank" rel="nofollow">zutrinken</a></span>
						<span class="credits-software">Published with <a href="http://gohugo.io" target="_blank" rel="nofollow">Hugo</a></span>
					</section>
				</footer>
				
				
<div id="tocMenu" data-target="toc">
    <div class="menu-header">
        <span class="menu-label">Menu</span>
        <a class="menu-close" data-action="toc" data-target="toc"></a>
    </div>
    <div id="toc" class="menu-list">
        <nav id="TableOfContents">
<ul>
<li><a href="#手取り足取りの難しさ">手取り足取りの難しさ</a></li>
<li><a href="#cloudstackがッ-泣くまで-イジメるのをやめないッ">CloudStackがッ 泣くまで イジメるのをやめないッ！</a>
<ul>
<li><a href="#参考にした情報">参考にした情報</a></li>
<li><a href="#構成">構成</a></li>
<li><a href="#構築">構築</a></li>
<li><a href="#余談-という名の八つ当たり">「余談」という名の八つ当たり</a>
<ul>
<li><a href="#面倒その壱">面倒その壱</a></li>
<li><a href="#面倒その弐">面倒その弐</a></li>
<li><a href="#面倒その参">面倒その参</a></li>
</ul></li>
<li><a href="#後日談">後日談</a></li>
</ul></li>
<li><a href="#deltacloud-で-eucalyptus-を利用してみる">DeltaCloud で Eucalyptus を利用してみる？</a>
<ul>
<li><a href="#事前確認">事前確認</a></li>
<li><a href="#インストール">インストール</a></li>
<li><a href="#サーバの実行">サーバの実行</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>


				<div class="overlay"></div>
			</div>
		</section>

    <script>
      (function(c,f){asyncLoader=function(i,h){i.foreach(function(k,j){e(j,d(j),h)});if(typeof h.callback=="function"){var g=setInterval(function(){if(f.readyState==="complete"){clearInterval(g);h.callback()}},10)}};var d=function(g){var h=g.split(".");return h[h.length-1]},e=function(h,i,g){switch(i){case"js":a(h,g);break;case"css":b(h);break;default:break}},a=function(i,h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=i;document.getElementsByTagName("head")[0].appendChild(g)},b=function(g){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=g;document.getElementsByTagName("head")[0].appendChild(h)};Array.prototype.foreach=function(h){for(var g=0;g<this.length;g++){h(g,this[g])}}})(this,document);

      asyncLoader([
				"/js/dependencies.js",
				"/css/dependencies.css"
      ],{
        callback:function(){
					asyncLoader([
						"/css/style.css",
						"/js/script.js"
					], {
						callback: function() {
							$('body').fadeIn( 800 );
						}
					});
        }
      });

</script>



</body>
</html>

